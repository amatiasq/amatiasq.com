---
import DatedEntryLink from '@components/molecules/DatedEntryLink.astro';
import Tr from '@components/atoms/Tr.astro';
import BaseLayout from '@layouts/BaseLayout.astro';
import { readCollection, type AnyEntry } from '@util/content';
import { getYear } from '@util/date';

interface Props {
    collection: keyof AnyEntry;
}

const { collection } = Astro.props;
const entries = await readCollection(collection);
const perYear: Record<number, typeof entries> = {};

for (const post of entries.reverse()) {
    const year = getYear(post) ?? 0;
    perYear[year] ??= [];
    perYear[year]!.push(post);
}
---

<BaseLayout class="entry-list">
    <slot name="list-title" />
    <slot name="list-description" />

    {Object.entries(perYear)
        .reverse()
        .map(([year, posts]) =>
            <>
                <h2>
                    {year || <Tr en="Unknown date" es="Fecha desconocida" />}
                </h2>

                <ul>
                    {posts.map(post =>
                        <li>
                            <DatedEntryLink
                                collection={collection}
                                entry={post}
                            />
                        </li>
                    )}
                </ul>
            </>
        )
    }
</BaseLayout>

<style lang="scss" is:global>
    .entry-list {
        ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
    }
</style>
