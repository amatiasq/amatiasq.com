<!DOCTYPE html><html lang="es"><head><meta charSet="UTF-8"/><meta name="description" content="A. Matías Quezada&#x27;s personal website"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ECMAScript 5 _.extend | A. Matías Quezada</title><style> *, ::before, ::after { box-sizing: border-box; } html { line-sizing: normal; } body { margin: 0; } [hidden] { display: none; } h1 { font-size: 2rem; } h2 { font-size: 1.5rem; } h3 { font-size: 1.17rem; } h4 { font-size: 1.00rem; } h5 { font-size: 0.83rem; } h6 { font-size: 0.67rem; } h1 { margin: 0.67em 0; } pre { white-space: pre-wrap; } hr { border-style: solid; border-width: 1px 0 0; color: inherit; height: 0; overflow: visible; } img, svg, video, canvas, audio, iframe, embed, object { display: block; vertical-align: middle; max-width: 100%; } audio:not([controls]) { display:none; } picture { display: contents; } source { display: none; } img, svg, video, canvas { height: auto; } audio { width: 100%; } img { border-style: none; } svg { overflow: hidden; } article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section { display: block; } [type='checkbox'], [type='radio'] { box-sizing: border-box; padding: 0; } @media (prefers-reduced-motion: reduce) { *, ::before, ::after { animation-name: none !important; transition: none !important; } } </style><style>@font-face { font-family: 'Inconsolata'; font-style: normal; font-weight: 400; font-stretch: normal; font-display: swap; src: url(https://fonts.gstatic.com/s/inconsolata/v30/QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp4U8aRo.ttf) format('truetype'); } @font-face { font-family: 'Inconsolata'; font-style: normal; font-weight: 700; font-stretch: normal; font-display: swap; src: url(https://fonts.gstatic.com/s/inconsolata/v30/QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp2I7aRo.ttf) format('truetype'); } @font-face { font-family: 'Nunito'; font-style: normal; font-weight: 400; font-display: swap; src: url(https://fonts.gstatic.com/s/nunito/v24/XRXI3I6Li01BKofiOc5wtlZ2di8HDLshRTM.ttf) format('truetype'); } @font-face { font-family: 'Nunito'; font-style: normal; font-weight: 700; font-display: swap; src: url(https://fonts.gstatic.com/s/nunito/v24/XRXI3I6Li01BKofiOc5wtlZ2di8HDFwmRTM.ttf) format('truetype'); } @font-face { font-family: 'Nunito Sans'; font-style: normal; font-weight: 400; font-display: swap; src: url(https://fonts.gstatic.com/s/nunitosans/v12/pe0qMImSLYBIv1o4X1M8cfe6.ttf) format('truetype'); } @font-face { font-family: 'Nunito Sans'; font-style: normal; font-weight: 700; font-display: swap; src: url(https://fonts.gstatic.com/s/nunitosans/v12/pe03MImSLYBIv1o4X1M8cc8GBv5q.ttf) format('truetype'); } </style><style> :root { background-color: #263238; color: #FDFBF8; font-family: Nunito Sans, sans-serif; font-size: 18px; line-height: 1.5; letter-spacing: 0.5px; --color-primary: #00FBFF; } header, h1, h2, h3, h4, h5, h6 { font-family: Nunito, sans-serif; } a { color: var(--color-primary); text-decoration: none; } :root { --external-link: url("data:image/svg+xml;utf8, %3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%2300FBFF' stroke='COLOR' viewBox='0 0 24 24' %3E %3Cpath d='M6 17c2.269-9.881 11-11.667 11-11.667v-3.333l7 6.637-7 6.696v-3.333s-6.17-.171-11 5zm12 .145v2.855h-16v-12h6.598c.768-.787 1.561-1.449 2.339-2h-10.937v16h20v-6.769l-2 1.914z'/%3E %3C/svg%3E "); } a[href^="http"]:not([href^="https://repos.amatiasq.com"]):not(.no-external)::after { content: ''; margin-left: 0.5em; width: 0.8em; height: 0.8em; display: inline-block; background-image: var(--external-link); background-repeat: no-repeat; background-position: center; background-size: contain; } :where(.bouncy-box, article a) { position: relative; display: inline-block; --underline-width: 1px; --padding: 8; transform: scale(1) rotate(0); transition: transform 0.3s cubic-bezier(0.25, 0.1, 0, 2.05); } :where(.bouncy-box, article a):hover { transform: scale(1.1) rotate(0); } :where(.bouncy-box, article a):before { content: ''; position: absolute; z-index: -1; border-radius: 8px; opacity: 1; background: var(--color-primary); inset: calc(100% - var(--underline-width)) 0 0 0; height: var(--underline-width); transition-property: inset, opacity, height, background; transition-duration: 0.3s; transition-timing-function: cubic-bezier(0,.5,0,1); } :where(.bouncy-box, article a):hover:before { inset: calc(var(--padding) * -1px) calc(var(--padding) * -2px); background: black; opacity: 0.8; height: calc(100% + calc(var(--padding) * 2px)); } ol { padding: 0; } li { list-style: none; } code { font-family: Inconsolata, monospace; } svg { fill: #FDFBF8; } </style><style>.css-1r8v4cp{display:none;}@media (min-width: 769px){.css-1r8v4cp{--size:1.5rem;display:block;position:fixed;overflow:hidden;bottom:calc(var(--size) * -1);right:calc(var(--size) * -1);height:calc(var(--size) * 2);width:calc(var(--size) * 2);border-radius:var(--size);transition-duration:0.3s;transition-timing-function:cubic-bezier(0.25, 0.1, 0, 2.05);transtition-property:height,width;}.css-1r8v4cp:hover,.css-1r8v4cp:focus-within{--size:6rem;}.css-1r8v4cp:hover label,.css-1r8v4cp:focus-within label{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);opacity:1;}.css-1r8v4cp input{background:transparent;margin:-10px;border:none;width:calc(var(--size) * 2);height:calc(var(--size) * 2);}.css-1r8v4cp label{opacity:0;background:rgba(0, 0, 0, 0.8);border-radius:16px;padding:0.3em 1em;position:fixed;bottom:2rem;right:7rem;color:var(--color-primary);font-weight:bold;-webkit-transform:rotate(90deg);-moz-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg);transform-origin:100% 1000%;-webkit-transition:-webkit-transform 0.3s,opacity 1s;transition:transform 0.3s,opacity 1s;}}
.css-13sgw9j{margin-top:10rem;overflow:hidden;}.css-13sgw9j #disqus_thread{margin-top:-50px;margin-bottom:-36px;}
.css-5a8vm2 .shj-inline{margin:0;padding:2px 5px;display:inline-block;border-radius:5px;}.css-5a8vm2 [class*=shj-lang-]::selection,.css-5a8vm2 [class*=shj-lang-] ::selection{background:#bdf5;}.css-5a8vm2 [class*=shj-lang-]>div{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;overflow:auto;}.css-5a8vm2 [class*=shj-lang-]>div :last-child{-webkit-flex:1;-ms-flex:1;flex:1;outline:none;}.css-5a8vm2 .shj-syn-cmnt{font-style:italic;}.css-5a8vm2 .shj-syn-err,.css-5a8vm2 .shj-syn-kwd{color:#e16;}.css-5a8vm2 .shj-syn-num,.css-5a8vm2 .shj-syn-class{color:#f60;}.css-5a8vm2 .shj-numbers,.css-5a8vm2 .shj-syn-cmnt{color:#999;}.css-5a8vm2 .shj-syn-insert,.css-5a8vm2 .shj-syn-str{color:#7d8;}.css-5a8vm2 .shj-syn-bool{color:#3bf;}.css-5a8vm2 .shj-syn-type,.css-5a8vm2 .shj-syn-oper{color:#5af;}.css-5a8vm2 .shj-syn-section,.css-5a8vm2 .shj-syn-func{color:#84f;}.css-5a8vm2 .shj-syn-deleted,.css-5a8vm2 .shj-syn-var{color:#f44;}.css-5a8vm2 .shj-oneline{padding:12px 10px;}.css-5a8vm2 .shj-lang-http.shj-oneline .shj-syn-kwd{background:#25f;color:#fff;padding:5px 7px;border-radius:5px;}.css-5a8vm2 .shj-multiline.shj-mode-header{padding:20px;}.css-5a8vm2 .shj-multiline.shj-mode-header:before{content:attr(data-lang);color:#58f;display:block;padding:10px 20px;background:#58f3;border-radius:5px;margin-bottom:20px;}.css-5a8vm2 [class*=shj-lang-]:before{color:#6f9aff;}.css-5a8vm2 .shj-syn-deleted,.css-5a8vm2 .shj-syn-err,.css-5a8vm2 .shj-syn-var{color:#e06c75;}.css-5a8vm2 .shj-syn-section,.css-5a8vm2 .shj-syn-oper,.css-5a8vm2 .shj-syn-kwd{color:#c678dd;}.css-5a8vm2 .shj-syn-class{color:#e5c07b;}.css-5a8vm2 .shj-numbers,.css-5a8vm2 .shj-syn-cmnt{color:#76839a;}.css-5a8vm2 .shj-syn-insert{color:#98c379;}.css-5a8vm2 .shj-syn-type{color:#56b6c2;}.css-5a8vm2 .shj-syn-num,.css-5a8vm2 .shj-syn-bool{color:#d19a66;}.css-5a8vm2 .shj-syn-str,.css-5a8vm2 .shj-syn-func{color:#61afef;}
.css-2bthvy{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji';}.css-2bthvy li{list-style:initial;}.css-2bthvy ul,.css-2bthvy ol{margin:20px 0;padding:reset;}.css-2bthvy p{margin:20px 0;text-align:justify;}.css-2bthvy blockquote{border-left:5px solid #586369;margin-left:0;padding-left:1em;}.css-2bthvy code:not(.code-block){background-color:#161b22;padding:4px;border-radius:4px;}.css-2bthvy pre{--code-block-margin:3em;--code-block-padding:1em;--code-inline-padding:min(3em, var(--container-side-gap));margin:var(--code-block-margin) 0;padding:var(--code-block-padding) 0;position:relative;white-space:pre;}.css-2bthvy pre .code-block{display:block;width:var(--available-width);white-space:pre;text-shadow:none;font-size:18px;line-height:24px;box-sizing:border-box;max-width:var(--available-width);overflow-x:auto;color:#abb2bf;}.css-2bthvy pre::before{content:'';inset:calc(var(--code-block-padding) * -1) calc(var(--code-inline-padding) * -1);background:#161b22;border-radius:10px;box-shadow:0 0 5px #0001;position:absolute;z-index:-1;max-width:100vw;}
.css-84fmch{opacity:0.8;font-size:0.8em;font-family:Inconsolata,monospace;color:#FDFBF8;white-space:nowrap;}
.css-v6zv8e{font-family:Nunito,sans-serif;font-weight:700;font-size:32px;}
.css-relzm4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width: 769px){.css-relzm4{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}
.css-18junyj{font-size:24px;color:white;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:baseline;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;gap:12px;letter-spacing:1px;}.css-18junyj abbr{display:inline-block;width:0.8em;overflow:hidden;-webkit-transition:width 0.3s ease;transition:width 0.3s ease;}.css-18junyj:hover abbr{width:3.3em;}
.css-1y1oy5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:12px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.css-147lofe{--container-side-gap:2rem;--container-width:40rem;--container-sides-gap:calc(var(--container-side-gap) * 2);--available-width:min(
      calc(100vw - var(--container-sides-gap)),
      calc(var(--container-width) - var(--container-sides-gap))
    );max-width:var(--container-width);padding-left:var(--container-side-gap);padding-right:var(--container-side-gap);margin-left:auto;margin-right:auto;}@media (min-width: 769px){.css-147lofe{--container-width:50rem;--container-side-gap:3rem;}}@media (min-width: 1200px){.css-147lofe{--container-width:60rem;}}
.css-x7nza2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:12px;}.css-x7nza2 a{color:var(--color-primary);margin-left:12px;border-bottom:1px solid transparent;-webkit-transform:translate(0px, 0px);-moz-transform:translate(0px, 0px);-ms-transform:translate(0px, 0px);transform:translate(0px, 0px);}.css-x7nza2 a.parent{border-bottom:1px solid #586369;}.css-x7nza2 a:hover{border-bottom:1px solid var(--color-primary);-webkit-transition:-webkit-transform 1s ease;transition:transform 1s ease;-webkit-transform:translate(0px, -3px);-moz-transform:translate(0px, -3px);-ms-transform:translate(0px, -3px);transform:translate(0px, -3px);}
.css-17rdaxl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width: 769px){.css-17rdaxl{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}
.css-del8gj{padding:12px 0;background-color:#161b22;color:#FDFBF8;border-bottom:2px solid #586369;}@media (min-width: 769px){.css-del8gj{position:-webkit-sticky;position:sticky;top:0;z-index:1;}}@media (min-width: 1200px){.css-del8gj{padding:20px 0;}}
.css-1e8d7s{padding-bottom:4rem;}
.css-1p4f3y5{display:grid;padding-top:20px;gap:12px;}</style><script>const onDomLoaded = new Promise((resolve) =>
  addEventListener('DOMContentLoaded', resolve)
);

let $ = (selector) => onDomLoaded.then(() => document.querySelector(selector));

onDomLoaded.then(
  () => ($ = (selector) => Promise.resolve(document.querySelector(selector)))
);


          const exteranLinkVariable = '--external-link';
          const getExternalLinkBackground = function anonymous(color
) {

    function svgToUrl(svg) {
    const escaped = svg.replace(/</g, '%3C').replace(/>/g, '%3E').replace(/"/g, "'").replace(/(\s|\n)+/g, ' ').replace(/#/g, '%23');
    return `url("data:image/svg+xml;utf8,${escaped}")`;
}
    const svg = `
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    fill="COLOR"
    stroke="COLOR"
    viewBox="0 0 24 24"
  >
    <path d="M6 17c2.269-9.881 11-11.667 11-11.667v-3.333l7 6.637-7 6.696v-3.333s-6.17-.171-11 5zm12 .145v2.855h-16v-12h6.598c.768-.787 1.561-1.449 2.339-2h-10.937v16h20v-6.769l-2 1.914z"/>
  </svg>
`
    return svgToUrl(svg.replace('COLOR', color));
  
};
          const PRIMARY_COLOR_KEY = 'amatiasq.com|color-primary';

function changePrimaryColor(newColor) {
  if (!newColor) return;

  const root = document.documentElement.style;

  root.setProperty('--color-primary', newColor);
  root.setProperty(exteranLinkVariable, getExternalLinkBackground(newColor));

  localStorage.setItem(PRIMARY_COLOR_KEY, newColor);

  $('#color-picker').then(($picker) => {
    $picker.value = newColor;
  });
}

changePrimaryColor(localStorage.getItem(PRIMARY_COLOR_KEY));

        </script></head><body class=" css-1e8d7s"><header class="css-del8gj "><div class="css-17rdaxl css-147lofe"><h2 class="css-1y1oy5"><a href="../.." class="css-18junyj inactive">{ <abbr>Adrian</abbr> Matías Quezada }</a></h2><nav class="css-x7nza2"><a href=".." class="parent">Blog</a><a href="../../projects" class="">Proyectos</a><a href="../../career" class="">CV</a><a href="../../../blog/2013-04-30-ecmascript5-extend" class="">🇬🇧</a></nav></div></header><div class="css-1p4f3y5 css-147lofe"><h2 class="css-relzm4  css-v6zv8e">ECMAScript 5 _.extend<time class="css-84fmch " dateTime="30/04/2013">30 abr 2013</time></h2><article class="md css-2bthvy css-5a8vm2 "><p>A algunos ya os he comentado los problemas que <a href="http://www.nczonline.net/blog/2012/12/11/are-your-mixins-ecmascript-5-compatible/">NC Zakas comenta</a> con el <code>_.extend</code> de underscore y los getters:</p>

<pre><code class="code-block shj-lang-js"><span class="shj-syn-kwd">var</span> a <span class="shj-syn-oper">=</span> {
  init<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> () {
    <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>list <span class="shj-syn-oper">=</span> [];
  }<span class="shj-syn-oper">,</span>

  <span class="shj-syn-kwd">get</span> <span class="shj-syn-func">first</span>() {
    <span class="shj-syn-kwd">return</span> <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>list[<span class="shj-syn-num">0</span>];
  }<span class="shj-syn-oper">,</span>
};
</code></pre>
<!-- end extract -->
<p>O</p>

<pre><code class="code-block shj-lang-js"><span class="shj-syn-kwd">var</span> a <span class="shj-syn-oper">=</span> {
  init<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> () {
    <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>list <span class="shj-syn-oper">=</span> [];
  }<span class="shj-syn-oper">,</span>
};

<span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">defineProperty</span>(a<span class="shj-syn-oper">,</span> <span class="shj-syn-str">'first'</span><span class="shj-syn-oper">,</span> {
  <span class="shj-syn-kwd">get</span><span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> () {
    <span class="shj-syn-kwd">return</span> <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>list[<span class="shj-syn-num">0</span>];
  }<span class="shj-syn-oper">,</span>
});
</code></pre>
<p>Y que si hacemos <code>_.extend(a)</code> va a fallar porque intentará hacer <code>result.first = a.first</code> ejecutando el getter. Pero como aún no hemos llamado al <code>.init()</code> en <code>a</code> porque solo es un prototipo, la propiedad <code>.list</code> es undefined produciendo un error.</p>
<p>Pues bien, yo creía que esto se solucionaba extrayendo el descriptor de la propiedad y usando ese mismo descriptor para copiar la propiedad al nuevo objeto:</p>

<pre><code class="code-block shj-lang-js"><span class="shj-syn-kwd">function</span> <span class="shj-syn-func">extend</span>(obj) {
  <span class="shj-syn-kwd">var</span> result <span class="shj-syn-oper">=</span> {};
  <span class="shj-syn-kwd">var</span> properties <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">keys</span>(obj);

  properties<span class="shj-syn-oper">.</span><span class="shj-syn-func">forEach</span>(<span class="shj-syn-kwd">function</span> (prop) {
    <span class="shj-syn-kwd">var</span> descriptor <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">getOwnPropertyDescriptor</span>(obj<span class="shj-syn-oper">,</span> prop);
    <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">defineProperty</span>(result<span class="shj-syn-oper">,</span> prop<span class="shj-syn-oper">,</span> descriptor);
  });

  <span class="shj-syn-kwd">return</span> result;
}
</code></pre>
<p>Pero he usado esto en la librería de promises y me he dado cuenta que solo hereda las propiedades directas, tanto <code>Object.keys</code> como <code>Object.getOwnPropertyDescriptor</code> solo funcionan si la propiedad está directamente declarada en el objeto y no en ninguno de sus prototipos. Y no hay ninguna forma de decir <code>Object.getPropertyDescriptorFromHimOrHisPrototypes()</code> así que la única forma es recorrer todos los prototipos.</p>

<pre><code class="code-block shj-lang-js"><span class="shj-syn-kwd">function</span> <span class="shj-syn-func">extend</span>(obj) {
  <span class="shj-syn-kwd">var</span> result <span class="shj-syn-oper">=</span> {};
  <span class="shj-syn-kwd">var</span> proto <span class="shj-syn-oper">=</span> obj;

  <span class="shj-syn-kwd">while</span> (proto) {
    <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">keys</span>(proto)<span class="shj-syn-oper">.</span><span class="shj-syn-func">forEach</span>(<span class="shj-syn-kwd">function</span> (prop) {
      <span class="shj-syn-kwd">var</span> descriptor <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">getOwnPropertyDescriptor</span>(proto<span class="shj-syn-oper">,</span> prop);
      <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">defineProperty</span>(result<span class="shj-syn-oper">,</span> prop<span class="shj-syn-oper">,</span> descriptor);
    });

    proto <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">getPrototypeOf</span>(proto);
  }

  <span class="shj-syn-kwd">return</span> result;
}
</code></pre>
<p>Pero eso tampoco funciona del todo bien porque las propiedades de los ancestros se impondrían sobre las propiedades propias del objeto. Así que primero hay que empezar por el último prototipo y acabar por el propio objeto</p>

<pre><code class="code-block shj-lang-js"><span class="shj-syn-kwd">function</span> <span class="shj-syn-func">extend</span>(obj) {
  <span class="shj-syn-kwd">var</span> result <span class="shj-syn-oper">=</span> {};
  <span class="shj-syn-kwd">var</span> proto <span class="shj-syn-oper">=</span> obj;
  <span class="shj-syn-kwd">var</span> protos <span class="shj-syn-oper">=</span> [];

  <span class="shj-syn-kwd">while</span> (proto) {
    protos<span class="shj-syn-oper">.</span><span class="shj-syn-func">push</span>(proto);
    proto <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">getPrototypeOf</span>(proto);
  }

  protos<span class="shj-syn-oper">.</span><span class="shj-syn-func">reverse</span>()<span class="shj-syn-oper">.</span><span class="shj-syn-func">forEach</span>(<span class="shj-syn-kwd">function</span> (ancestor) {
    <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">keys</span>(ancestor)<span class="shj-syn-oper">.</span><span class="shj-syn-func">forEach</span>(<span class="shj-syn-kwd">function</span> (prop) {
      <span class="shj-syn-kwd">var</span> descriptor <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">getOwnPropertyDescriptor</span>(ancestor<span class="shj-syn-oper">,</span> prop);
      <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">defineProperty</span>(result<span class="shj-syn-oper">,</span> prop<span class="shj-syn-oper">,</span> descriptor);
    });
  });

  <span class="shj-syn-kwd">return</span> result;
}
</code></pre>
<p>Y esto ya funciona, pero le falta un detallito, mediante el property descriptor se puede poner que una propiedad no sea enumerable por lo que no se interará sobre ella con un <code>for .. in ..</code> ni con <code>Object.keys</code> pero si las podemos obtener si utilizamos <code>Object.getOwnPropertyNames</code> (Fuente: <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames">MDN</a>). Así que remplazando <code>Object.keys</code> con <code>Object.getOwnPropertyNames</code> esta vez si (espero, rezo, suplico -.-) tenemos una función que crea una copia de todas las propiedades propias y heredadas de un objeto.</p>

<pre><code class="code-block shj-lang-js"><span class="shj-syn-kwd">function</span> <span class="shj-syn-func">ecma5extend</span>(obj) {
  <span class="shj-syn-kwd">var</span> proto <span class="shj-syn-oper">=</span> obj;
  <span class="shj-syn-kwd">var</span> protos <span class="shj-syn-oper">=</span> [];
  <span class="shj-syn-kwd">var</span> result <span class="shj-syn-oper">=</span> {};

  <span class="shj-syn-kwd">while</span> (proto) {
    protos<span class="shj-syn-oper">.</span><span class="shj-syn-func">push</span>(proto);
    proto <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">getPrototypeOf</span>(proto);
  }

  protos<span class="shj-syn-oper">.</span><span class="shj-syn-func">reverse</span>()<span class="shj-syn-oper">.</span><span class="shj-syn-func">forEach</span>(<span class="shj-syn-kwd">function</span> (ancestor) {
    <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">getOwnPropertyNames</span>(ancestor)<span class="shj-syn-oper">.</span><span class="shj-syn-func">forEach</span>(<span class="shj-syn-kwd">function</span> (prop) {
      <span class="shj-syn-kwd">var</span> descriptor <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">getOwnPropertyDescriptor</span>(ancestor<span class="shj-syn-oper">,</span> prop);
      <span class="shj-syn-class">Object</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">defineProperty</span>(result<span class="shj-syn-oper">,</span> prop<span class="shj-syn-oper">,</span> descriptor);
    });
  });

  <span class="shj-syn-kwd">return</span> result;
}
</code></pre>
<p>Como al final el código ha quedado bastante más complejo de lo que me gustaría lo he apuntado en <a href="https://gist.github.com/amatiasq/5492466">un Gist</a> que podría venirles bien.</p>
</article><section class="css-13sgw9j"><div id="disqus_thread"></div><script defer=""> var disqus_config=function(){ this.page.url = `${location.origin}${location.pathname}`; this.page.identifier = '/blog/2013-04-30-ecmascript5-extend'; }; (function(){ var d=document,s=d.createElement('script'); s.src='https://amatiasq.disqus.com/embed.js'; s.setAttribute('data-timestamp',+new Date()); (d.head || d.body).appendChild(s); })(); </script><noscript>Comments can&#x27;t be shown with Javascript disabled. Use a browser with Javascript to see them.</noscript></section></div><div class="css-1r8v4cp"><input type="color" id="color-picker" value="#00ffe1"/><label for="color-picker">Cambia el color principal!</label><script defer=""> document.querySelector('#color-picker').addEventListener('input', (e) => changePrimaryColor(e.target.value) ); </script></div></body></html>