<!DOCTYPE html><html lang="es"><head><meta charSet="UTF-8"/><meta name="description" content="A. Matías Quezada&#x27;s personal website"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Generar páginas HTML desde TSX con Deno | A. Matías Quezada</title><style> *, ::before, ::after { box-sizing: border-box; } html { line-sizing: normal; } body { margin: 0; } [hidden] { display: none; } h1 { font-size: 2rem; } h2 { font-size: 1.5rem; } h3 { font-size: 1.17rem; } h4 { font-size: 1.00rem; } h5 { font-size: 0.83rem; } h6 { font-size: 0.67rem; } h1 { margin: 0.67em 0; } pre { white-space: pre-wrap; } hr { border-style: solid; border-width: 1px 0 0; color: inherit; height: 0; overflow: visible; } img, svg, video, canvas, audio, iframe, embed, object { display: block; vertical-align: middle; max-width: 100%; } audio:not([controls]) { display:none; } picture { display: contents; } source { display: none; } img, svg, video, canvas { height: auto; } audio { width: 100%; } img { border-style: none; } svg { overflow: hidden; } article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section { display: block; } [type='checkbox'], [type='radio'] { box-sizing: border-box; padding: 0; } @media (prefers-reduced-motion: reduce) { *, ::before, ::after { animation-name: none !important; transition: none !important; } } </style><style>@font-face { font-family: 'Inconsolata'; font-style: normal; font-weight: 400; font-stretch: normal; font-display: swap; src: url(https://fonts.gstatic.com/s/inconsolata/v30/QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp4U8aRo.ttf) format('truetype'); } @font-face { font-family: 'Inconsolata'; font-style: normal; font-weight: 700; font-stretch: normal; font-display: swap; src: url(https://fonts.gstatic.com/s/inconsolata/v30/QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp2I7aRo.ttf) format('truetype'); } @font-face { font-family: 'Nunito'; font-style: normal; font-weight: 400; font-display: swap; src: url(https://fonts.gstatic.com/s/nunito/v24/XRXI3I6Li01BKofiOc5wtlZ2di8HDLshRTM.ttf) format('truetype'); } @font-face { font-family: 'Nunito'; font-style: normal; font-weight: 700; font-display: swap; src: url(https://fonts.gstatic.com/s/nunito/v24/XRXI3I6Li01BKofiOc5wtlZ2di8HDFwmRTM.ttf) format('truetype'); } @font-face { font-family: 'Nunito Sans'; font-style: normal; font-weight: 400; font-display: swap; src: url(https://fonts.gstatic.com/s/nunitosans/v12/pe0qMImSLYBIv1o4X1M8cfe6.ttf) format('truetype'); } @font-face { font-family: 'Nunito Sans'; font-style: normal; font-weight: 700; font-display: swap; src: url(https://fonts.gstatic.com/s/nunitosans/v12/pe03MImSLYBIv1o4X1M8cc8GBv5q.ttf) format('truetype'); } </style><style> :root { background-color: #263238; color: #FDFBF8; font-family: Nunito Sans, sans-serif; font-size: 18px; line-height: 1.5; letter-spacing: 0.5px; --color-primary: #8BB9F8; /* azul */ --color-primary: #8BA9FF; /* French Sky Blue */ --color-primary: #70ACFF; /* French Sky Blue 2 */ --color-primary: #FC9173; /* Dark Salmom */ --color-primary: #00ff01; /* Verde familia */ --color-primary: #00ffe1; /* Cyan Romi */ // --color-primary: #00ffe1; } header, h1, h2, h3, h4, h5, h6 { font-family: Nunito, sans-serif; } a { color: var(--color-primary); text-decoration: none; } a[href^="http"]:not(.no-external)::after { content: ''; margin-left: 0.5em; width: 0.8em; height: 0.8em; display: inline-block; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='%2300ffe1' stroke='%2300ffe1'%3E%3Cpath d='M6 17c2.269-9.881 11-11.667 11-11.667v-3.333l7 6.637-7 6.696v-3.333s-6.17-.171-11 5zm12 .145v2.855h-16v-12h6.598c.768-.787 1.561-1.449 2.339-2h-10.937v16h20v-6.769l-2 1.914z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: center; background-size: contain; } :where(.bouncy-box, article a) { position: relative; display: inline-block; --underline-width: 1px; --padding: 8; transform: scale(1) rotate(0); transition: transform 0.3s cubic-bezier(0.25, 0.1, 0, 2.05); } :where(.bouncy-box, article a):hover { transform: scale(1.1) rotate(0); } :where(.bouncy-box, article a):before { content: ''; position: absolute; z-index: -1; border-radius: 8px; opacity: 1; background: var(--color-primary); inset: calc(100% - var(--underline-width)) 0 0 0; height: var(--underline-width); transition-property: inset, opacity, height, background; transition-duration: 0.3s; transition-timing-function: cubic-bezier(0,.5,0,1); } :where(.bouncy-box, article a):hover:before { inset: calc(var(--padding) * -1px) calc(var(--padding) * -2px); background: black; opacity: 0.8; height: calc(100% + calc(var(--padding) * 2px)); } ol { padding: 0; } li { list-style: none; } code { font-family: Inconsolata, monospace; } svg { fill: #FDFBF8; } </style><style>.css-1ljukny{position:fixed;bottom:1rem;right:1rem;background-color:black;}.css-1ljukny input{border:none;width:3rem;height:3rem;}
.css-5a8vm2 .shj-inline{margin:0;padding:2px 5px;display:inline-block;border-radius:5px;}.css-5a8vm2 [class*=shj-lang-]::selection,.css-5a8vm2 [class*=shj-lang-] ::selection{background:#bdf5;}.css-5a8vm2 [class*=shj-lang-]>div{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;overflow:auto;}.css-5a8vm2 [class*=shj-lang-]>div :last-child{-webkit-flex:1;-ms-flex:1;flex:1;outline:none;}.css-5a8vm2 .shj-syn-cmnt{font-style:italic;}.css-5a8vm2 .shj-syn-err,.css-5a8vm2 .shj-syn-kwd{color:#e16;}.css-5a8vm2 .shj-syn-num,.css-5a8vm2 .shj-syn-class{color:#f60;}.css-5a8vm2 .shj-numbers,.css-5a8vm2 .shj-syn-cmnt{color:#999;}.css-5a8vm2 .shj-syn-insert,.css-5a8vm2 .shj-syn-str{color:#7d8;}.css-5a8vm2 .shj-syn-bool{color:#3bf;}.css-5a8vm2 .shj-syn-type,.css-5a8vm2 .shj-syn-oper{color:#5af;}.css-5a8vm2 .shj-syn-section,.css-5a8vm2 .shj-syn-func{color:#84f;}.css-5a8vm2 .shj-syn-deleted,.css-5a8vm2 .shj-syn-var{color:#f44;}.css-5a8vm2 .shj-oneline{padding:12px 10px;}.css-5a8vm2 .shj-lang-http.shj-oneline .shj-syn-kwd{background:#25f;color:#fff;padding:5px 7px;border-radius:5px;}.css-5a8vm2 .shj-multiline.shj-mode-header{padding:20px;}.css-5a8vm2 .shj-multiline.shj-mode-header:before{content:attr(data-lang);color:#58f;display:block;padding:10px 20px;background:#58f3;border-radius:5px;margin-bottom:20px;}.css-5a8vm2 [class*=shj-lang-]:before{color:#6f9aff;}.css-5a8vm2 .shj-syn-deleted,.css-5a8vm2 .shj-syn-err,.css-5a8vm2 .shj-syn-var{color:#e06c75;}.css-5a8vm2 .shj-syn-section,.css-5a8vm2 .shj-syn-oper,.css-5a8vm2 .shj-syn-kwd{color:#c678dd;}.css-5a8vm2 .shj-syn-class{color:#e5c07b;}.css-5a8vm2 .shj-numbers,.css-5a8vm2 .shj-syn-cmnt{color:#76839a;}.css-5a8vm2 .shj-syn-insert{color:#98c379;}.css-5a8vm2 .shj-syn-type{color:#56b6c2;}.css-5a8vm2 .shj-syn-num,.css-5a8vm2 .shj-syn-bool{color:#d19a66;}.css-5a8vm2 .shj-syn-str,.css-5a8vm2 .shj-syn-func{color:#61afef;}
.css-2bthvy{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji';}.css-2bthvy li{list-style:initial;}.css-2bthvy ul,.css-2bthvy ol{margin:20px 0;padding:reset;}.css-2bthvy p{margin:20px 0;text-align:justify;}.css-2bthvy blockquote{border-left:5px solid #586369;margin-left:0;padding-left:1em;}.css-2bthvy code:not(.code-block){background-color:#161b22;padding:4px;border-radius:4px;}.css-2bthvy pre{--code-block-margin:3em;--code-block-padding:1em;--code-inline-padding:min(3em, var(--container-side-gap));margin:var(--code-block-margin) 0;padding:var(--code-block-padding) 0;position:relative;white-space:pre;}.css-2bthvy pre .code-block{display:block;width:var(--available-width);white-space:pre;text-shadow:none;font-size:18px;line-height:24px;box-sizing:border-box;max-width:var(--available-width);overflow-x:auto;color:#abb2bf;}.css-2bthvy pre::before{content:'';inset:calc(var(--code-block-padding) * -1) calc(var(--code-inline-padding) * -1);background:#161b22;border-radius:10px;box-shadow:0 0 5px #0001;position:absolute;z-index:-1;max-width:100vw;}
.css-84fmch{opacity:0.8;font-size:0.8em;font-family:Inconsolata,monospace;color:#FDFBF8;white-space:nowrap;}
.css-v6zv8e{font-family:Nunito,sans-serif;font-weight:700;font-size:32px;}
.css-relzm4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width: 769px){.css-relzm4{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}
.css-18junyj{font-size:24px;color:white;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:baseline;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;gap:12px;letter-spacing:1px;}.css-18junyj abbr{display:inline-block;width:0.8em;overflow:hidden;-webkit-transition:width 0.3s ease;transition:width 0.3s ease;}.css-18junyj:hover abbr{width:3.3em;}
.css-1y1oy5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:12px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.css-18wymod{--container-side-gap:1rem;--container-width:40rem;--container-sides-gap:calc(var(--container-side-gap) * 2);--available-width:min(
      calc(100vw - var(--container-sides-gap)),
      calc(var(--container-width) - var(--container-sides-gap))
    );max-width:var(--container-width);padding-left:var(--container-side-gap);padding-right:var(--container-side-gap);margin-left:auto;margin-right:auto;}@media (min-width: 769px){.css-18wymod{--container-width:50rem;--container-side-gap:3rem;}}@media (min-width: 1200px){.css-18wymod{--container-width:60rem;}}
.css-x7nza2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:12px;}.css-x7nza2 a{color:var(--color-primary);margin-left:12px;border-bottom:1px solid transparent;-webkit-transform:translate(0px, 0px);-moz-transform:translate(0px, 0px);-ms-transform:translate(0px, 0px);transform:translate(0px, 0px);}.css-x7nza2 a.parent{border-bottom:1px solid #586369;}.css-x7nza2 a:hover{border-bottom:1px solid var(--color-primary);-webkit-transition:-webkit-transform 1s ease;transition:transform 1s ease;-webkit-transform:translate(0px, -3px);-moz-transform:translate(0px, -3px);-ms-transform:translate(0px, -3px);transform:translate(0px, -3px);}
.css-17rdaxl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width: 769px){.css-17rdaxl{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}
.css-1witpq9{padding:20px 0;background-color:#161b22;color:#FDFBF8;border-bottom:2px solid #586369;}@media (min-width: 769px){.css-1witpq9{position:-webkit-sticky;position:sticky;top:0;z-index:1;}}
.css-1e8d7s{padding-bottom:4rem;}
.css-1p4f3y5{display:grid;padding-top:20px;gap:12px;}</style></head><body class=" css-1e8d7s"><header class="css-1witpq9 "><div class="css-17rdaxl css-18wymod"><h2 class="css-1y1oy5"><a href="../.." class="css-18junyj inactive">{ <abbr>Adrian</abbr> Matías Quezada }</a></h2><nav class="css-x7nza2"><a href=".." class="parent">Blog</a><a href="../../projects" class="">Proyectos</a><a href="../../career" class="">CV</a><a href="../../../blog/2022-07-04-generate-html-pages-from-markdown-with-deno" class="">🇬🇧</a></nav></div></header><div class="css-1p4f3y5 css-18wymod"><h2 class="css-relzm4  css-v6zv8e">Generar páginas HTML desde TSX con Deno<time class="css-84fmch " dateTime="04/07/2022">4 jul 2022</time></h2><article class="md css-2bthvy css-5a8vm2 "><p>He estado trabajando en una versión nueva de este sitio con una idea clara:</p>

<ul>
<li>Quiero escribir el contenido en Markdown</li>
<li>Quiero que sea el sitio más rápido que ha habido (negociable)</li>
<li>Bilingüe (N-lingüe de hecho)</li>
</ul>
<p>Después de unos meses de trabajo me encontré tomando la misma presunción no escrita que recientemente comenté a mi amiga @Shakira, quién me ayudó con este hermoso diseño 🙌</p>
<blockquote>
<p>Voy a animar la cabecera de alguna forma sólo con CSS, no hay lugar para Javascript en el sitio del tipo del Javascript. Ese es el mensaje 🤣</p>
</blockquote>
<p>Eso es todo.</p>
<p>El post puede terminar aquí.</p>
<p>Pero tengo más que escribir:</p>
<p>Eso significa...</p>

<ul>
<li>Páginas con HTML / CSS plano</li>
<li>CSS / JS embebido directamente en el HTML</li>
<li>solo el CSS / JS necesario se incluye</li>
</ul>
<p>Y... necesito probar [Deno], parece genial, suena genial y sabes que encontrarás problemas cuando empieces a usarlo pero cuáles podrán ser?</p>
<p>Aquí está el camino para generar páginas HTML desde TSX con Deno:</p>

<ul>
<li>Tienes [Deno] instalado</li>
<li>Crea un archivo <code>.tsx</code></li>
<li>importar <code>React</code> de <code>https://esm.sh/react</code></li>
<li>importar <code>{ renderToStaticMarkup }</code> de <code>https://esm.sh/react-dom/server</code>;</li>
<li>esto:</li>
</ul>

<pre><code class="code-block shj-lang-ts"><span class="shj-syn-cmnt">// Las versiones se incluyen por importantes razones! 🥲
</span><span class="shj-syn-kwd">import</span> <span class="shj-syn-class">React</span> <span class="shj-syn-kwd">from</span> <span class="shj-syn-str">'https://esm.sh/react@18.2.0'</span>
<span class="shj-syn-kwd">import</span> { renderToStaticMarkup } <span class="shj-syn-kwd">from</span> <span class="shj-syn-str">'https://esm.sh/react-dom@18.2.0/server'</span>;

<span class="shj-syn-cmnt">// Este es nuestro único componente
</span><span class="shj-syn-kwd">function</span> <span class="shj-syn-class">MyComponent</span>() {
  <span class="shj-syn-kwd">return</span> <span class="shj-syn-oper">&lt;</span>p<span class="shj-syn-oper">&gt;</span>Ésta es mi página<span class="shj-syn-oper">!&lt;</span>p<span class="shj-syn-oper">&gt;</span>
}

<span class="shj-syn-cmnt">// renderToStaticMarkup hace la magia
</span><span class="shj-syn-kwd">const</span> html <span class="shj-syn-oper">=</span> <span class="shj-syn-func">renderToStaticMarkup</span>(<span class="shj-syn-oper">&lt;</span><span class="shj-syn-class">MyComponent</span> <span class="shj-syn-oper">/&gt;</span>);

<span class="shj-syn-cmnt">// enviar el HTML resultante a la salida del programa
</span>console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(html);
</code></pre>
<p>&quot;Pero Matías! quiero que esto se pueda leer de / escribir a disco! no desde el mismo código!&quot;</p>

<pre><code class="code-block shj-lang-ts"><span class="shj-syn-cmnt">// main.tsx
</span><span class="shj-syn-kwd">import</span> <span class="shj-syn-class">React</span> <span class="shj-syn-kwd">from</span> <span class="shj-syn-str">'https://esm.sh/react@18.2.0'</span>
<span class="shj-syn-kwd">import</span> { renderToStaticMarkup } <span class="shj-syn-kwd">from</span> <span class="shj-syn-str">'https://esm.sh/react-dom@18.2.0/server'</span>;

<span class="shj-syn-cmnt">// leemos los argumentos
</span><span class="shj-syn-kwd">const</span> [input<span class="shj-syn-oper">,</span> output] <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span>args;

<span class="shj-syn-cmnt">// input/output pueden ser relativos al directorio de trabajo del usuario
</span><span class="shj-syn-kwd">const</span> cwd <span class="shj-syn-oper">=</span> <span class="shj-syn-str">`file://</span><span class="shj-syn-kwd">${</span><span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">cwd</span>()<span class="shj-syn-kwd">}</span><span class="shj-syn-str">/`</span>;

<span class="shj-syn-kwd">const</span> input_fullpath <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-num">URL</span>(input<span class="shj-syn-oper">,</span> cwd)<span class="shj-syn-oper">.</span>pathname
<span class="shj-syn-kwd">const</span> output_fullpath <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-num">URL</span>(output<span class="shj-syn-oper">,</span> cwd)<span class="shj-syn-oper">.</span>pathname

<span class="shj-syn-cmnt">// Importar el archivo .tsx que contiene la página
</span><span class="shj-syn-kwd">const</span> inputModule <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">await</span> <span class="shj-syn-kwd">import</span>(input_fullpath);
<span class="shj-syn-kwd">const</span> <span class="shj-syn-class">Page</span> <span class="shj-syn-oper">=</span> inputModule<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">default</span>;

<span class="shj-syn-kwd">const</span> html <span class="shj-syn-oper">=</span> <span class="shj-syn-func">renderToStaticMarkup</span>(<span class="shj-syn-oper">&lt;</span><span class="shj-syn-class">Page</span> randomProp<span class="shj-syn-oper">=</span><span class="shj-syn-str">"yay"</span> <span class="shj-syn-oper">/&gt;</span>);

<span class="shj-syn-kwd">await</span> <span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">writeTextFile</span>(output_fullpath<span class="shj-syn-oper">,</span> html);
</code></pre>

<pre><code class="code-block shj-lang-ts"><span class="shj-syn-cmnt">// MyPage.tsx
</span><span class="shj-syn-kwd">import</span> <span class="shj-syn-class">React</span> <span class="shj-syn-kwd">from</span> <span class="shj-syn-str">'https://esm.sh/react@18.2.0'</span>

<span class="shj-syn-kwd">export</span> <span class="shj-syn-kwd">default</span> () <span class="shj-syn-kwd">=&gt;</span> <span class="shj-syn-oper">&lt;</span>p<span class="shj-syn-oper">&gt;</span>Ésta es mi página<span class="shj-syn-oper">!&lt;</span>p<span class="shj-syn-oper">&gt;</span>
</code></pre>

<pre><code class="code-block shj-lang-bash">deno run \
  <span class="shj-syn-oper">--</span>allow<span class="shj-syn-kwd">-read</span><span class="shj-syn-oper">=</span>. \
  <span class="shj-syn-oper">--</span>allow<span class="shj-syn-kwd">-write</span><span class="shj-syn-oper">=</span>. \
  <span class="shj-syn-oper">--</span>allow<span class="shj-syn-kwd">-net</span><span class="shj-syn-oper">=</span>https:<span class="shj-syn-oper">//</span>esm.sh \
  .<span class="shj-syn-oper">/</span>main.tsx \
  .<span class="shj-syn-oper">/</span>MyPage.tsx .<span class="shj-syn-oper">/</span>MyPage.html
</code></pre>
<p>Permisos explicados:</p>

<ul>
<li><code>--allow-read=.</code> permite que el script lea la carpeta en la que estamos: <code>.</code></li>
<li><code>--allow-write=.</code> lo mismo que arriba, solo se necesita acceso a <code>input</code>/<code>output</code> pero <code>.</code> es suficiente la mayoría de las veces</li>
<li><code>--allow-net=https://esm.sh</code> requiere acceso a esm.sh para descargar las dependencias: <code>react</code> and <code>react-dom</code></li>
<li><code>./main.tsx</code> esto no es un permiso, es el nombre del archivo que creamos allá arriba!</li>
<li><code>./MyPage.tsx ./MyPage.html</code> estos son los argumentos que se pasarán como <code>input</code> y <code>ouput</code>, es que no estabas prestando atención!?</li>
</ul>
<p>Ok pero podemos hacerlo mejor, no queremos pasar archivo por archivo, queremos darle una carpeta y que genere la misma estructura, si tan solo tuvieramos un...</p>

<pre><code class="code-block shj-lang-ts"><span class="shj-syn-cmnt">// Leer archivos recursivamente
</span><span class="shj-syn-kwd">export</span> <span class="shj-syn-kwd">async</span> <span class="shj-syn-kwd">function</span> <span class="shj-syn-func">getFilesRecursively</span>(currentPath<span class="shj-syn-type">: string</span>) {
  <span class="shj-syn-kwd">const</span> names<span class="shj-syn-type">: string</span>[] <span class="shj-syn-oper">=</span> [];

  <span class="shj-syn-kwd">for</span> <span class="shj-syn-kwd">await</span> (<span class="shj-syn-kwd">const</span> dirEntry <span class="shj-syn-kwd">of</span> <span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">readDir</span>(currentPath)) {
    <span class="shj-syn-kwd">const</span> entryPath <span class="shj-syn-oper">=</span> <span class="shj-syn-str">`</span><span class="shj-syn-kwd">${</span>root<span class="shj-syn-kwd">}</span><span class="shj-syn-str">/</span><span class="shj-syn-kwd">${</span>dirEntry<span class="shj-syn-oper">.</span>name<span class="shj-syn-kwd">}</span><span class="shj-syn-str">`</span>;

    <span class="shj-syn-kwd">if</span> (dirEntry<span class="shj-syn-oper">.</span>isDirectory) {
      names<span class="shj-syn-oper">.</span><span class="shj-syn-func">push</span>(<span class="shj-syn-oper">...</span>(<span class="shj-syn-kwd">await</span> <span class="shj-syn-func">getFilesRecursively</span>(entryPath))<span class="shj-syn-oper">.</span><span class="shj-syn-func">sort</span>());
    } <span class="shj-syn-kwd">else</span> {
      names<span class="shj-syn-oper">.</span><span class="shj-syn-func">push</span>(entryPath);
    }
  }

  <span class="shj-syn-kwd">return</span> names;
}
</code></pre>
<p>Estoy seguro que algo así es parte de <code>esm.sh/std</code> por algún lado. Ahora vamos a actualizar el <code>main.tsx</code> que creamos arriba:</p>

<pre><code class="code-block shj-lang-ts"><span class="shj-syn-cmnt">// main.tsx
</span><span class="shj-syn-kwd">import</span> <span class="shj-syn-class">React</span> <span class="shj-syn-kwd">from</span> <span class="shj-syn-str">'https://esm.sh/react@18.2.0'</span>
<span class="shj-syn-kwd">import</span> { renderToStaticMarkup } <span class="shj-syn-kwd">from</span> <span class="shj-syn-str">'https://esm.sh/react-dom@18.2.0/server'</span>;

<span class="shj-syn-cmnt">// Importamos una función para obtener el nombre del directorio de un archivo
</span><span class="shj-syn-kwd">import</span> { dirname } <span class="shj-syn-kwd">from</span> <span class="shj-syn-str">'https://deno.land/std@0.143.0/path/mod.ts'</span>;

<span class="shj-syn-kwd">const</span> [input<span class="shj-syn-oper">,</span> output] <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span>args;

<span class="shj-syn-cmnt">// función auxiliar, hay algo en deno.land/std como esto?
</span><span class="shj-syn-kwd">const</span> relativeToCwd <span class="shj-syn-oper">=</span> (target<span class="shj-syn-type">: string</span>) <span class="shj-syn-kwd">=&gt;</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-num">URL</span>(target<span class="shj-syn-oper">,</span> <span class="shj-syn-str">`file://</span><span class="shj-syn-kwd">${</span><span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">cwd</span>()<span class="shj-syn-kwd">}</span><span class="shj-syn-str">/`</span>);

<span class="shj-syn-kwd">const</span> input_dir <span class="shj-syn-oper">=</span> <span class="shj-syn-func">relativeToCwd</span>(<span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span>args[<span class="shj-syn-num">0</span>]);
<span class="shj-syn-kwd">const</span> output_dir <span class="shj-syn-oper">=</span> <span class="shj-syn-func">relativeToCwd</span>(<span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span>args[<span class="shj-syn-num">1</span>]);

<span class="shj-syn-kwd">for</span> (<span class="shj-syn-kwd">const</span> file <span class="shj-syn-kwd">of</span> <span class="shj-syn-kwd">await</span> <span class="shj-syn-func">getFilesRecursively</span>(input_dir)) {
  <span class="shj-syn-cmnt">// Importar el archivo .tsx que contiene la página
</span>  <span class="shj-syn-kwd">const</span> inputModule <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">await</span> <span class="shj-syn-kwd">import</span>(input_fullpath);
  <span class="shj-syn-kwd">const</span> <span class="shj-syn-class">Page</span> <span class="shj-syn-oper">=</span> inputModule<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">default</span>;

  <span class="shj-syn-kwd">const</span> html <span class="shj-syn-oper">=</span> <span class="shj-syn-func">renderToStaticMarkup</span>(<span class="shj-syn-oper">&lt;</span><span class="shj-syn-class">Page</span> randomProp<span class="shj-syn-oper">=</span><span class="shj-syn-str">"yay"</span> <span class="shj-syn-oper">/&gt;</span>);

  <span class="shj-syn-cmnt">// ./input/mydir/myfile.tsx
</span>  <span class="shj-syn-cmnt">// se convierte en
</span>  <span class="shj-syn-cmnt">// ./output/mydir/myfile.html
</span>  <span class="shj-syn-kwd">const</span> destination <span class="shj-syn-oper">=</span> file
    <span class="shj-syn-oper">.</span><span class="shj-syn-func">replace</span>(input_dir<span class="shj-syn-oper">,</span> output_dir)
    <span class="shj-syn-oper">.</span><span class="shj-syn-func">replace</span>(<span class="shj-syn-oper">/.tsx</span><span class="shj-syn-kwd">$</span><span class="shj-syn-oper">/</span><span class="shj-syn-oper">,</span> <span class="shj-syn-str">'.html'</span>);

  <span class="shj-syn-cmnt">// Esto crea todas las carpetas necesarias
</span>  <span class="shj-syn-cmnt">// Además si la carpeta ya existe no lanza error :)
</span>  <span class="shj-syn-kwd">await</span> <span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">mkdir</span>(<span class="shj-syn-func">dirname</span>(destination)<span class="shj-syn-oper">,</span> { recursive<span class="shj-syn-oper">:</span> <span class="shj-syn-bool">true</span> });

  <span class="shj-syn-cmnt">// Escribir el HTML generado a disco
</span>  <span class="shj-syn-kwd">await</span> <span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">writeTextFile</span>(destination<span class="shj-syn-oper">,</span> html);
}
</code></pre>
<p>A veces encontrás necesario borrar la carpeta de salida antes de empezar a escribir en ella... hice esto que no es hermoso pero hace el trabajo 🤷‍♀️</p>

<pre><code class="code-block shj-lang-ts"><span class="shj-syn-kwd">try</span> {
  <span class="shj-syn-cmnt">// Esta función tira un error incluso con `{ recursive: true }` lo cuál tiene sentido
</span>  <span class="shj-syn-kwd">await</span> <span class="shj-syn-class">Deno</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">remove</span>(output<span class="shj-syn-oper">,</span> { recursive<span class="shj-syn-oper">:</span> <span class="shj-syn-bool">true</span> });
} <span class="shj-syn-kwd">catch</span> {}
</code></pre>
<p>From this you can start creating your site with JS knowing no JS will be rendered in the browser.</p>

<pre><code class="code-block shj-lang-ts"><span class="shj-syn-cmnt">// input/index.tsx
</span><span class="shj-syn-kwd">import</span> <span class="shj-syn-class">React</span> <span class="shj-syn-kwd">from</span> <span class="shj-syn-str">'https://esm.sh/react@18.2.0'</span>

<span class="shj-syn-cmnt">// CSS puesto en una variable porque las llaves { } confundirían al JSX de React
</span><span class="shj-syn-kwd">const</span> styles <span class="shj-syn-oper">=</span> <span class="shj-syn-str">`
  .body { margin: 0 }
`</span>

<span class="shj-syn-kwd">export</span> <span class="shj-syn-kwd">default</span> () <span class="shj-syn-kwd">=&gt;</span> (
  <span class="shj-syn-oper">&lt;</span>html lang<span class="shj-syn-oper">=</span><span class="shj-syn-str">"en"</span><span class="shj-syn-oper">&gt;</span>
    <span class="shj-syn-oper">&lt;</span>head<span class="shj-syn-oper">&gt;</span>
      <span class="shj-syn-oper">&lt;</span>meta charSet<span class="shj-syn-oper">=</span><span class="shj-syn-str">"UTF-8"</span> <span class="shj-syn-oper">/&gt;</span>
      <span class="shj-syn-oper">&lt;</span>meta http<span class="shj-syn-oper">-</span>equiv<span class="shj-syn-oper">=</span><span class="shj-syn-str">"X-UA-Compatible"</span> content<span class="shj-syn-oper">=</span><span class="shj-syn-str">"IE=edge"</span> <span class="shj-syn-oper">/&gt;</span>
      <span class="shj-syn-oper">&lt;</span>meta name<span class="shj-syn-oper">=</span><span class="shj-syn-str">"viewport"</span> content<span class="shj-syn-oper">=</span><span class="shj-syn-str">"width=device-width, initial-scale=1.0"</span> <span class="shj-syn-oper">/&gt;</span>
      <span class="shj-syn-oper">&lt;</span>title<span class="shj-syn-oper">&gt;</span><span class="shj-syn-class">Mi</span> sitio web<span class="shj-syn-oper">!&lt;/</span>title<span class="shj-syn-oper">&gt;</span>
      <span class="shj-syn-oper">&lt;</span>style<span class="shj-syn-oper">&gt;</span>{styles}<span class="shj-syn-oper">&lt;/</span>style<span class="shj-syn-oper">&gt;</span>
    <span class="shj-syn-oper">&lt;/</span>head<span class="shj-syn-oper">&gt;</span>
    <span class="shj-syn-oper">&lt;</span>body<span class="shj-syn-oper">&gt;</span>
      <span class="shj-syn-oper">&lt;</span>p<span class="shj-syn-oper">&gt;</span><span class="shj-syn-class">Este</span> es mi índice<span class="shj-syn-oper">!&lt;</span>p<span class="shj-syn-oper">&gt;</span>
    <span class="shj-syn-oper">&lt;/</span>body<span class="shj-syn-oper">&gt;</span>
  <span class="shj-syn-oper">&lt;/</span>html<span class="shj-syn-oper">&gt;</span>
)
</code></pre>

<pre><code class="code-block shj-lang-bash">deno run \
  <span class="shj-syn-oper">--</span>allow<span class="shj-syn-kwd">-read</span><span class="shj-syn-oper">=</span>. \
  <span class="shj-syn-oper">--</span>allow<span class="shj-syn-kwd">-write</span><span class="shj-syn-oper">=</span>. \
  <span class="shj-syn-oper">--</span>allow<span class="shj-syn-kwd">-net</span><span class="shj-syn-oper">=</span>https:<span class="shj-syn-oper">//</span>esm.sh \
  .<span class="shj-syn-oper">/</span>main.tsx \
  .<span class="shj-syn-oper">/</span>input .<span class="shj-syn-oper">/</span>output
</code></pre>
<p>Y generaría un archivo como este:</p>

<pre><code class="code-block shj-lang-html"><span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">html</span> <span class="shj-syn-class">lang</span><span class="shj-syn-str"></span><span class="shj-syn-oper">=</span><span class="shj-syn-str">"en"</span><span class="shj-syn-oper">&gt;</span>
  <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">head</span><span class="shj-syn-oper">&gt;</span>
    <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">meta</span> <span class="shj-syn-class">charset</span><span class="shj-syn-str"></span><span class="shj-syn-oper">=</span><span class="shj-syn-str">"UTF-8"</span> <span class="shj-syn-oper">/&gt;</span>
    <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">meta</span> <span class="shj-syn-class">http-equiv</span><span class="shj-syn-str"></span><span class="shj-syn-oper">=</span><span class="shj-syn-str">"X-UA-Compatible"</span> <span class="shj-syn-class">content</span><span class="shj-syn-str"></span><span class="shj-syn-oper">=</span><span class="shj-syn-str">"IE=edge"</span> <span class="shj-syn-oper">/&gt;</span>
    <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">meta</span> <span class="shj-syn-class">name</span><span class="shj-syn-str"></span><span class="shj-syn-oper">=</span><span class="shj-syn-str">"viewport"</span> <span class="shj-syn-class">content</span><span class="shj-syn-str"></span><span class="shj-syn-oper">=</span><span class="shj-syn-str">"width=device-width, initial-scale=1.0"</span> <span class="shj-syn-oper">/&gt;</span>
    <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">title</span><span class="shj-syn-oper">&gt;</span>Mi sitio web!<span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;/</span><span class="shj-syn-var">title</span><span class="shj-syn-oper">&gt;</span>
    <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">style</span><span class="shj-syn-oper">&gt;</span>
      <span class="shj-syn-var">.body</span> { <span class="shj-syn-var">margin</span>: <span class="shj-syn-num">0</span> }
    <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;/</span><span class="shj-syn-var">style</span><span class="shj-syn-oper">&gt;</span>
  <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;/</span><span class="shj-syn-var">head</span><span class="shj-syn-oper">&gt;</span>
  <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">body</span><span class="shj-syn-oper">&gt;</span>
    <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">p</span><span class="shj-syn-oper">&gt;</span>Este es mi índice!<span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;</span><span class="shj-syn-var">p</span><span class="shj-syn-oper">&gt;</span>
  <span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;/</span><span class="shj-syn-var">body</span><span class="shj-syn-oper">&gt;</span>
<span class="shj-syn-var"></span><span class="shj-syn-oper">&lt;/</span><span class="shj-syn-var">html</span><span class="shj-syn-oper">&gt;</span>
</code></pre>
<p>&quot;Pero Matías, has dado tantas vueltas para tener una forma ligeramente más compleja de escribir HTML?&quot;</p>
<p>Si, exacto, gracias por darte cuenta. Ahora tenemos componentes y podemos crear componentes como la mirda y ya que importamos los archivos con <code>import()</code> todas las dependencias serán manejadas apropiadamente por Deno! No solo eso, un entorno Javascript signifca que podemos hacer todo tipo de lógica como procesado de Markdown antes de generar la página pero eso es otra historia.</p>
<p>Otras cosas que aprendí sobre la marcha y me encantaría escribir al respecto:</p>

<ul>
<li>Import maps (con o sin barra? AMBOS! y verión completa!)
<ul>
<li><code>/deps/some-dependency.ts</code> porqué aún lo encuentro útil</li>
<li>El infierno del archivo <code>lock.json</code> de Deno (y porqué existe)</li>
</ul>
</li>
</ul>
</article></div><div class="css-1ljukny"><input type="color" id="color-picker" value="#00ffe1"/>
          <script>
            document.querySelector('#color-picker').addEventListener('input', (e) => {
              document.body.style.setProperty('--color-primary', e.target.value);
            });
          </script>
        </div></body></html>