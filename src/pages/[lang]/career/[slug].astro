---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import { languages, useTranslations } from '@/i18n';
import NavHeader from '@/components/organisms/NavHeader.astro';
import Tr from '@/components/atoms/Translation.astro';
import Time from '@/components/atoms/Time.astro';
import Markdown from '@/components/molecules/Markdown.astro';
import Tags from '@/components/atoms/Tags.astro';

export async function getStaticPaths() {
  const career = await getCollection('career');

  return languages.flatMap((lang) =>
    career
      .filter((job) => !job.data.hide)
      .map((job) => ({
        params: { lang, slug: job.id.replace('.md', '') },
        props: { job, lang },
      }))
  );
}

const { job, lang } = Astro.props;
const { tr } = useTranslations(Astro.url);
const title = tr(job.data.org) || 'Career';
const content = Array.isArray(job.body) ? job.body : [job.body];
const localizedContent = content[languages.indexOf(lang)] || content[0] || '';
const slug = job.id.replace('.md', '');
---

<Layout title={title}>
  <NavHeader />
  <main>
    <article>
      <header>
        <h1 transition:name={`title-${slug}`}><Tr value={job.data.org} /></h1>
        <div class="meta">
          <Time date={job.data.from} omitDay /> â€” {job.data.to ? <Time date={job.data.to} omitDay /> : <Tr en="Current" es="Actual" />}
        </div>
        {job.data.role && <div class="role"><Tr value={job.data.role} /></div>}
        <Tags tags={job.data.tags} />
      </header>
      {localizedContent && <Markdown md={localizedContent} />}
    </article>
  </main>
</Layout>

<style>
  header {
    margin-bottom: 2rem;
  }

  h1 {
    margin-bottom: 0.5rem;
  }

  .meta {
    font-family: ui-monospace, 'SF Mono', Menlo, Monaco, monospace;
    color: #64748b;
    margin-bottom: 0.25rem;
  }

  .role {
    color: #94a3b8;
    font-size: 1.1rem;
  }
</style>
