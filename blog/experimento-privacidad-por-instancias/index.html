<!DOCTYPE html><html lang="en"><head><meta charSet="UTF-8"/><meta name="description" content="A. Matías Quezada&#x27;s personal website"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Experiment: Per-instance privacy (spanish) | A. Matías Quezada</title><style> *, ::before, ::after { box-sizing: border-box; } html { line-sizing: normal; } body { margin: 0; } [hidden] { display: none; } h1 { font-size: 2rem; } h2 { font-size: 1.5rem; } h3 { font-size: 1.17rem; } h4 { font-size: 1.00rem; } h5 { font-size: 0.83rem; } h6 { font-size: 0.67rem; } h1 { margin: 0.67em 0; } pre { white-space: pre-wrap; } hr { border-style: solid; border-width: 1px 0 0; color: inherit; height: 0; overflow: visible; } img, svg, video, canvas, audio, iframe, embed, object { display: block; vertical-align: middle; max-width: 100%; } audio:not([controls]) { display:none; } picture { display: contents; } source { display: none; } img, svg, video, canvas { height: auto; } audio { width: 100%; } img { border-style: none; } svg { overflow: hidden; } article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section { display: block; } [type='checkbox'], [type='radio'] { box-sizing: border-box; padding: 0; } @media (prefers-reduced-motion: reduce) { *, ::before, ::after { animation-name: none !important; transition: none !important; } } </style><style>@font-face { font-family: 'Inconsolata'; font-style: normal; font-weight: 400; font-stretch: normal; font-display: swap; src: url(https://fonts.gstatic.com/s/inconsolata/v32/QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp4U8aRo.ttf) format('truetype'); } @font-face { font-family: 'Inconsolata'; font-style: normal; font-weight: 700; font-stretch: normal; font-display: swap; src: url(https://fonts.gstatic.com/s/inconsolata/v32/QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp2I7aRo.ttf) format('truetype'); } @font-face { font-family: 'Nunito'; font-style: normal; font-weight: 400; font-display: swap; src: url(https://fonts.gstatic.com/s/nunito/v26/XRXI3I6Li01BKofiOc5wtlZ2di8HDLshRTM.ttf) format('truetype'); } @font-face { font-family: 'Nunito'; font-style: normal; font-weight: 700; font-display: swap; src: url(https://fonts.gstatic.com/s/nunito/v26/XRXI3I6Li01BKofiOc5wtlZ2di8HDFwmRTM.ttf) format('truetype'); } @font-face { font-family: 'Nunito Sans'; font-style: normal; font-weight: 400; font-stretch: normal; font-display: swap; src: url(https://fonts.gstatic.com/s/nunitosans/v15/pe1mMImSLYBIv1o4X1M8ce2xCx3yop4tQpF_MeTm0lfGWVpNn64CL7U8upHZIbMV51Q42ptCp5F5bxqqtQ1yiU4G1ilntA.ttf) format('truetype'); } @font-face { font-family: 'Nunito Sans'; font-style: normal; font-weight: 700; font-stretch: normal; font-display: swap; src: url(https://fonts.gstatic.com/s/nunitosans/v15/pe1mMImSLYBIv1o4X1M8ce2xCx3yop4tQpF_MeTm0lfGWVpNn64CL7U8upHZIbMV51Q42ptCp5F5bxqqtQ1yiU4GMS5ntA.ttf) format('truetype'); } </style><style> html:not(.light-scheme) { --color-primary: #00FBFF; --color-foreground: #FDFBF8; --color-foregroundStrong: #FFFFFF; --color-background: #263238; --color-backgroundStrong: #161b22; --color-border: #586369; } @media (prefers-color-scheme: light) { html { --color-primary: #0006B0; --color-foreground: #3a3a3a; --color-foregroundStrong: #000000; --color-background: #dae2e7; --color-backgroundStrong: #e3e7ed; --color-border: gray; } } html.light-scheme { --color-primary: #0006B0; --color-foreground: #3a3a3a; --color-foregroundStrong: #000000; --color-background: #dae2e7; --color-backgroundStrong: #e3e7ed; --color-border: gray; } body { background-color: var(--color-background); color: var(--color-foreground); font-family: Nunito Sans, sans-serif; font-size: 18px; line-height: 1.5; letter-spacing: 0.5px; } header, h1, h2, h3, h4, h5, h6 { font-family: Nunito, sans-serif; } a { color: var(--color-primary); text-decoration: none; } :root { --external-link: url("data:image/svg+xml;utf8, %3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%2300FBFF' stroke='COLOR' viewBox='0 0 24 24' %3E %3Cpath d='M6 17c2.269-9.881 11-11.667 11-11.667v-3.333l7 6.637-7 6.696v-3.333s-6.17-.171-11 5zm12 .145v2.855h-16v-12h6.598c.768-.787 1.561-1.449 2.339-2h-10.937v16h20v-6.769l-2 1.914z'/%3E %3C/svg%3E "); } a[href^="http"]:not([href^="https://amatiasq.com"]):not([href^="https://repos.amatiasq.com"]):not(.no-external)::after { content: ''; margin-left: 0.5em; width: 0.8em; height: 0.8em; display: inline-block; background-image: var(--external-link); background-repeat: no-repeat; background-position: center; background-size: contain; } :where(.bouncy-box, article a) { position: relative; display: inline-block; --underline-width: 1px; --padding: 8; transform: scale(1) rotate(0); transition: transform 0.3s cubic-bezier(0.25, 0.1, 0, 2.05); } :where(.bouncy-box, article a):hover { transform: scale(1.1) rotate(0); } :where(.bouncy-box, article a):before { content: ''; position: absolute; z-index: -1; border-radius: 8px; opacity: 1; background: transparents; inset: calc(100% - var(--underline-width)) 0 0 0; height: var(--underline-width); transition-property: inset, opacity, height, background; transition-duration: 0.3s; transition-timing-function: cubic-bezier(0,.5,0,1); } :where(.bouncy-box, article a):hover:before { inset: calc(var(--padding) * -1px) calc(var(--padding) * -2px); background: black; opacity: 0.8; height: calc(100% + calc(var(--padding) * 2px)); } ol { padding: 0; } li { list-style: none; } code { font-family: Inconsolata, monospace; } svg { fill: var(--color-foreground); } iframe { width: var(--available-width); height: var(--available-width); border: 2px solid var(--color-border); } summary { cursor: pointer; list-style: none; } summary::-webkit-details-marker { display: none; } .md summary { list-style: unset; } .md summary::-webkit-details-marker { display: unset; } </style><style>.css-1dwwgr5{display:none;}@media (min-width: 769px){.css-1dwwgr5{display:block;position:fixed;overflow:hidden;background-color:var(--color-primary);--size:2rem;bottom:calc(var(--size) * -1);right:calc(var(--size) * -1);height:calc(var(--size) * 2);width:calc(var(--size) * 2);border-radius:var(--size);transition-duration:0.3s;transition-timing-function:cubic-bezier(0.25, 0.1, 0, 2.05);transition-property:border-radius,bottom,right,height,width;}.css-1dwwgr5:hover,.css-1dwwgr5:focus-within{--size:6rem;}.css-1dwwgr5:hover p,.css-1dwwgr5:focus-within p{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);opacity:1;}.css-1dwwgr5 input{margin-top:-10rem;margin-left:-10rem;}.css-1dwwgr5 p{opacity:0;background:rgba(0, 0, 0, 0.8);border-radius:16px;padding:0.3em 1em;position:fixed;bottom:2rem;right:7rem;color:var(--color-primary);font-weight:bold;-webkit-transform:rotate(90deg);-moz-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg);transform-origin:100% 1000%;-webkit-transition:-webkit-transform 0.3s,opacity 1s;transition:transform 0.3s,opacity 1s;}}
.css-5a8vm2 .shj-inline{margin:0;padding:2px 5px;display:inline-block;border-radius:5px;}.css-5a8vm2 [class*=shj-lang-]::selection,.css-5a8vm2 [class*=shj-lang-] ::selection{background:#bdf5;}.css-5a8vm2 [class*=shj-lang-]>div{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;overflow:auto;}.css-5a8vm2 [class*=shj-lang-]>div :last-child{-webkit-flex:1;-ms-flex:1;flex:1;outline:none;}.css-5a8vm2 .shj-syn-cmnt{font-style:italic;}.css-5a8vm2 .shj-syn-err,.css-5a8vm2 .shj-syn-kwd{color:#e16;}.css-5a8vm2 .shj-syn-num,.css-5a8vm2 .shj-syn-class{color:#f60;}.css-5a8vm2 .shj-numbers,.css-5a8vm2 .shj-syn-cmnt{color:#999;}.css-5a8vm2 .shj-syn-insert,.css-5a8vm2 .shj-syn-str{color:#7d8;}.css-5a8vm2 .shj-syn-bool{color:#3bf;}.css-5a8vm2 .shj-syn-type,.css-5a8vm2 .shj-syn-oper{color:#5af;}.css-5a8vm2 .shj-syn-section,.css-5a8vm2 .shj-syn-func{color:#84f;}.css-5a8vm2 .shj-syn-deleted,.css-5a8vm2 .shj-syn-var{color:#f44;}.css-5a8vm2 .shj-oneline{padding:12px 10px;}.css-5a8vm2 .shj-lang-http.shj-oneline .shj-syn-kwd{background:#25f;color:#fff;padding:5px 7px;border-radius:5px;}.css-5a8vm2 .shj-multiline.shj-mode-header{padding:20px;}.css-5a8vm2 .shj-multiline.shj-mode-header:before{content:attr(data-lang);color:#58f;display:block;padding:10px 20px;background:#58f3;border-radius:5px;margin-bottom:20px;}.css-5a8vm2 [class*=shj-lang-]:before{color:#6f9aff;}.css-5a8vm2 .shj-syn-deleted,.css-5a8vm2 .shj-syn-err,.css-5a8vm2 .shj-syn-var{color:#e06c75;}.css-5a8vm2 .shj-syn-section,.css-5a8vm2 .shj-syn-oper,.css-5a8vm2 .shj-syn-kwd{color:#c678dd;}.css-5a8vm2 .shj-syn-class{color:#e5c07b;}.css-5a8vm2 .shj-numbers,.css-5a8vm2 .shj-syn-cmnt{color:#76839a;}.css-5a8vm2 .shj-syn-insert{color:#98c379;}.css-5a8vm2 .shj-syn-type{color:#56b6c2;}.css-5a8vm2 .shj-syn-num,.css-5a8vm2 .shj-syn-bool{color:#d19a66;}.css-5a8vm2 .shj-syn-str,.css-5a8vm2 .shj-syn-func{color:#61afef;}
.css-18iro54{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji';}.css-18iro54 li{list-style:initial;}.css-18iro54 ul,.css-18iro54 ol{margin:20px 0;padding:reset;}.css-18iro54 p{margin:20px 0;text-align:justify;}.css-18iro54 blockquote{border-left:5px solid var(--color-border);margin-left:0;padding-left:1em;}.css-18iro54 code:not(.code-block){background-color:var(--color-backgroundStrong);padding:4px;border-radius:4px;}.css-18iro54 pre{--code-block-margin:3em;--code-block-padding:1em;--code-inline-padding:min(3em, var(--container-side-gap));margin:var(--code-block-margin) 0;padding:var(--code-block-padding) 0;position:relative;white-space:pre;}.css-18iro54 pre >code{display:block;width:var(--available-width);white-space:pre;text-shadow:none;font-size:18px;line-height:24px;box-sizing:border-box;max-width:var(--available-width);overflow-x:auto;color:#abb2bf;}.css-18iro54 pre::before{content:'';inset:calc(var(--code-block-padding) * -1) calc(var(--code-inline-padding) * -1);background:#161b22;border-radius:10px;box-shadow:0 0 5px #0001;position:absolute;z-index:-1;max-width:100vw;}
.css-18paweh{opacity:0.8;font-size:0.8em;font-family:Inconsolata,monospace;color:var(--color-foreground);white-space:nowrap;}
.css-v6zv8e{font-family:Nunito,sans-serif;font-weight:700;font-size:32px;}
.css-relzm4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width: 769px){.css-relzm4{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}
.css-1wcd5po{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;background:none;border:none;font-size:inherit;}html:not(.light-scheme) .css-1wcd5po span:first-child{display:none;}@media (prefers-color-scheme: light){html .css-1wcd5po span:last-child{display:none;}}html.light-scheme .css-1wcd5po span:last-child{display:none;}
.css-1mi0geu{color:var(--color-foregroundStrong);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:baseline;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;letter-spacing:1px;white-space:nowrap;}.css-1mi0geu abbr{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;width:0.79em;overflow:hidden;-webkit-transition:width 0.3s ease;transition:width 0.3s ease;}.css-1mi0geu abbr,.css-1mi0geu span+span{margin-left:0.4em;}.css-1mi0geu:hover abbr{width:3.3em;}.css-1mi0geu:hover .dot{display:none;}
.css-1x2qc6k{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:12px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0;font-size:1.3em;}@media (min-width: 769px){.css-1x2qc6k{font-size:1.5em;}}
.css-147lofe{--container-side-gap:2rem;--container-width:40rem;--container-sides-gap:calc(var(--container-side-gap) * 2);--available-width:min(
      calc(100vw - var(--container-sides-gap)),
      calc(var(--container-width) - var(--container-sides-gap))
    );max-width:var(--container-width);padding-left:var(--container-side-gap);padding-right:var(--container-side-gap);margin-left:auto;margin-right:auto;}@media (min-width: 769px){.css-147lofe{--container-width:50rem;--container-side-gap:3rem;}}@media (min-width: 1200px){.css-147lofe{--container-width:60rem;}}
.css-1134qic{cursor:pointer;font-size:var(--emoji-size);-webkit-transition:font-size 0.15s ease-in-out;transition:font-size 0.15s ease-in-out;margin-top:-5px;}
.css-qam5gc{cursor:pointer;font-size:var(--emoji-size);-webkit-transition:font-size 0.15s ease-in-out;transition:font-size 0.15s ease-in-out;}
.css-syhxvc{color:var(--color-primary);margin-right:12px;border-bottom:1px solid transparent;-webkit-transform:translate(0px, 0px);-moz-transform:translate(0px, 0px);-ms-transform:translate(0px, 0px);transform:translate(0px, 0px);}.css-syhxvc.parent{border-bottom:1px solid var(--color-border);}.css-syhxvc:hover{border-bottom:1px solid var(--color-primary);-webkit-transition:-webkit-transform 1s ease;transition:transform 1s ease;-webkit-transform:translate(0px, -3px);-moz-transform:translate(0px, -3px);-ms-transform:translate(0px, -3px);transform:translate(0px, -3px);}
.css-1nl2wzu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;white-space:nowrap;gap:12px;}
.css-1qscrim{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-flex-flow:column wrap;-webkit-flex-flow:column wrap;-ms-flex-flow:column wrap;flex-flow:column wrap;gap:20px;}.css-1qscrim .not-priority{display:none;}@media (min-width: 769px){.css-1qscrim{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}@media (min-width: 1200px){.css-1qscrim .not-priority{display:block;}}
.css-el2kyp{--emoji-size:1.5rem;background-color:var(--color-backgroundStrong);color:var(--color-foreground);border-bottom:2px solid var(--color-border);padding:40px 0;font-size:1.2em;}@media (min-width: 769px){.css-el2kyp{--emoji-size:2rem;position:-webkit-sticky;position:sticky;top:0;z-index:1;-webkit-transition:padding 0.15s ease-in-out,font-size 0.15s ease-in-out;transition:padding 0.15s ease-in-out,font-size 0.15s ease-in-out;}.css-el2kyp.scrolled{--emoji-size:1.5rem;padding:12px 0;font-size:inherit;}}
.css-1e8d7s{padding-bottom:4rem;}
.css-1p4f3y5{display:grid;padding-top:20px;gap:12px;}</style><script>;(async () => {const doc = document.documentElement; const onDomLoaded = new Promise((resolve) => addEventListener('DOMContentLoaded', resolve) ); async function $(selector) { await onDomLoaded; return document.querySelector(selector); } async function $$(selector) { await onDomLoaded; return [...document.querySelectorAll(selector)]; } onDomLoaded.then(() => { $ = (selector) => Promise.resolve(document.querySelector(selector)); $$ = (selector) => Promise.resolve([...document.querySelectorAll(selector)]); }); Object.assign(window, { $, $$, doc }); })();
;(async () => {const COLOR_SCHEME_KEY = 'amatiasq.com|color-scheme'; if (localStorage.getItem(COLOR_SCHEME_KEY)) { doc.classList.toggle('light-scheme'); } doc.addEventListener('amq-primary-color-ready', () => { if (localStorage.getItem(COLOR_SCHEME_KEY)) { primaryColorChanged(); } }); const button = await $('[data-togglecolorscheme]'); button.addEventListener('click', () => { if (doc.classList.toggle('light-scheme')) { localStorage.setItem(COLOR_SCHEME_KEY, 'light'); } else { localStorage.removeItem(COLOR_SCHEME_KEY); } primaryColorChanged ? primaryColorChanged() : null; }); button.removeAttribute('data-togglecolorscheme'); })();
;(async () => { const getExternalLinkBackground = function anonymous(color ) { function svgToUrl(svg) { const escaped = svg.replace(/</g, '%3C').replace(/>/g, '%3E').replace(/"/g, "'").replace(/(\s|\n)+/g, ' ').replace(/#/g, '%23'); return `url("data:image/svg+xml;utf8,${escaped}")`; } const svg = ` <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="COLOR" stroke="COLOR" viewBox="0 0 24 24" > <path d="M6 17c2.269-9.881 11-11.667 11-11.667v-3.333l7 6.637-7 6.696v-3.333s-6.17-.171-11 5zm12 .145v2.855h-16v-12h6.598c.768-.787 1.561-1.449 2.339-2h-10.937v16h20v-6.769l-2 1.914z"/> </svg> `; return svgToUrl(svg.replace('COLOR', color)); }; const PRIMARY_COLOR_KEY = 'amatiasq.com|color-primary'; function changePrimaryColor(newColor) { if (!newColor) return; doc.style.setProperty('--color-primary', newColor); localStorage.setItem(PRIMARY_COLOR_KEY, newColor); primaryColorChanged(newColor); } function primaryColorChanged( newColor = getComputedStyle(doc).getPropertyValue('--color-primary') ) { const event = new CustomEvent('amq-primary-color-changed', { detail: newColor, }); doc.dispatchEvent(event); } Object.assign(window, { primaryColorChanged }); doc.addEventListener('amq-primary-color-changed', async (event) => { const newColor = event.detail; doc.style.setProperty('--external-link', getExternalLinkBackground(newColor)); const $picker = await $('#color-picker'); $picker.value = newColor.trim(); }); changePrimaryColor(localStorage.getItem(PRIMARY_COLOR_KEY)); doc.dispatchEvent(new Event('amq-primary-color-ready')); const picker = await $('#color-picker'); picker.addEventListener('input', (e) => changePrimaryColor(e.target.value)); })();</script></head><body class=" css-1e8d7s"><script type="module" defer="">;(async () => {const scrollers = (await $$('[data-scrollclass]')) .map((x) => ({ el: x, className: x.dataset.scrollclass, offset: x.dataset.scrolloffset || 0, tolerance: x.dataset.scrolltolerance || 0, })) .filter((x) => x.className); const pendingScrollers = new Set(scrollers); if (pendingScrollers.size) { addEventListener('scroll', () => { const scrolled = document.documentElement.scrollTop; for (const { el, className, offset, tolerance } of pendingScrollers) { const scrollDiff = scrolled - offset; if (Math.abs(scrollDiff) < tolerance) { return; } const hasClass = el.classList.contains(className); const shouldHaveClass = scrollDiff > 0; if (shouldHaveClass === hasClass) { return; } if (shouldHaveClass) { el.classList.add(className); } else { el.classList.remove(className); } } }); } })();</script><header class="css-el2kyp " data-scrollclass="scrolled" data-scrolloffset="50" data-scrolltolerance="50"><div class="css-1qscrim css-147lofe"><h2 class="css-1x2qc6k"><a href="../.." class="css-1mi0geu inactive"><span>{ </span><abbr>Adrian</abbr><span class="dot">.</span><span>Matías Quezada</span><span> }</span></a></h2><nav class="css-1nl2wzu"><a href=".." class="css-syhxvc parent">Blog</a><a href="../../projects" class="css-syhxvc not-priority">Projects</a><a href="../../career" class="css-syhxvc">CV</a><a href="../../es/blog/experimento-privacidad-por-instancias" class="css-qam5gc">🇪🇸</a><button class="css-1wcd5po css-1134qic" data-togglecolorscheme="true"><span>🌒</span><span>☀️</span></button></nav></div></header><div class="css-1p4f3y5  css-147lofe"><h2 class="css-relzm4  css-v6zv8e">Experiment: Per-instance privacy (spanish)<time class="css-18paweh " dateTime="03/03/2012">Mar 3, 2012</time></h2><article class="md css-18iro54 css-5a8vm2 "><blockquote>
<p>Actualización 19/3/2014: Sorprendentemente parece que una propuesta del ECMAScript 6 sigue mismo el patrón descrito en este post, y yo que pensaba que era demasiado rebuscado...</p>
<p><a href="http://wiki.ecmascript.org/doku.php?id=harmony:classes">http://wiki.ecmascript.org/doku.php?id=harmony:classes</a></p>
</blockquote>
<p>Como ya comenté, la privacidad en Javascript es un tema peliagudo, <strong>el lenguaje no nos ofrece ninguna herramienta para gestionar la privacidad</strong> automáticamente, tenemos que aprovechar el scope de <strong>los closures para ocultar información</strong> que el usuario de nuestra librería no necesita saber, <strong>pero ocultar propiedades de una instancia es mucho más complicado</strong>. Hace algunos años me empeñé en buscar una forma de conseguir privacidad por instancias que no fuera mediante el constructor, como ya expliqué en el [post anterior][1].</p>
<!-- end extract -->
<p>Para empezar está claro que es necesario tener un closure, para ocultar las variables desde fuera:</p>

<pre><code class="code-block shj-lang-js"><span class="shj-syn-cmnt">// función de ejecución inmediata
</span>(<span class="shj-syn-kwd">function</span> (global) {
  <span class="shj-syn-cmnt">// Contenido oculto
</span>})(<span class="shj-syn-kwd">this</span>);
</code></pre>
<p>Dentro de éste closure definiría la clase:</p>

<pre><code class="code-block shj-lang-js">(<span class="shj-syn-kwd">function</span> (global) {
  <span class="shj-syn-kwd">function</span> <span class="shj-syn-class">Persona</span>() {
    <span class="shj-syn-kwd">var</span> secreto;
  }

  <span class="shj-syn-class">Persona</span><span class="shj-syn-oper">.</span>prototype <span class="shj-syn-oper">=</span> {
    guardarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (susurro) {
      secreto <span class="shj-syn-oper">=</span> susurro;
    }<span class="shj-syn-oper">,</span>
    revelarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> () {
      <span class="shj-syn-kwd">return</span> secreto;
    }<span class="shj-syn-oper">,</span>
  };

  global<span class="shj-syn-oper">.</span><span class="shj-syn-class">Persona</span> <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Persona</span>;
})(<span class="shj-syn-kwd">this</span>);
</code></pre>
<p>Evidentemente es imposible acceder a la variable <code>secreto</code> desde los métodos porque <code>secreto</code> <strong>está encerrada en el constructor y no se puede acceder ella desde fuera</strong> del constructor. Así que si quiero privacidad sin meter los métodos en el constructor por los métodos que [ya expliqué][2] la solución pasa por sacar la variable del constructor:</p>

<pre><code class="code-block shj-lang-js">(<span class="shj-syn-kwd">function</span> (global) {
  <span class="shj-syn-kwd">var</span> secreto;

  <span class="shj-syn-kwd">function</span> <span class="shj-syn-class">Persona</span>() {}
  <span class="shj-syn-class">Persona</span><span class="shj-syn-oper">.</span>prototype <span class="shj-syn-oper">=</span> {
    guardarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (susurro) {
      secreto <span class="shj-syn-oper">=</span> susurro;
    }<span class="shj-syn-oper">,</span>
    revelarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> () {
      <span class="shj-syn-kwd">return</span> secreto;
    }<span class="shj-syn-oper">,</span>
  };

  global<span class="shj-syn-oper">.</span><span class="shj-syn-class">Persona</span> <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Persona</span>;
})(<span class="shj-syn-kwd">this</span>);

<span class="shj-syn-kwd">var</span> pepe <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();
<span class="shj-syn-kwd">var</span> maria <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();
pepe<span class="shj-syn-oper">.</span><span class="shj-syn-func">guardarSecreto</span>(<span class="shj-syn-str">'estás en matrix'</span>);
console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(maria<span class="shj-syn-oper">.</span><span class="shj-syn-func">revelarSecreto</span>());
</code></pre>
<p><a href="http://jsfiddle.net/amatiasq/eXfkL/" target="_blank">Pruébame</a></p>
<p>Bien, ahora <code>secreto</code> está fuera del constructor, pero tenemos otro problema, <strong>todas las instancias de <code>Persona</code> comparten la misma variable!</strong> Hay que buscar la forma de contar un secreto a <code>pepe</code> sin que <code>maria</code> se entere, dicho de otra forma, de guardar un valor en una instancia sin modificar la otra. En Javascript es muy sencillo trabajar con mappings así que porqué no guardamos en un mapping la relación instancia-valor? Así cada instancia podrá tener su valor guardado en la variable secreto sin interferir con el valor de otra instancia.</p>

<pre><code class="code-block shj-lang-js">(<span class="shj-syn-kwd">function</span> (global) {
  <span class="shj-syn-kwd">var</span> secreto <span class="shj-syn-oper">=</span> {};

  <span class="shj-syn-kwd">function</span> <span class="shj-syn-class">Persona</span>() {}
  <span class="shj-syn-class">Persona</span><span class="shj-syn-oper">.</span>prototype <span class="shj-syn-oper">=</span> {
    guardarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (susurro) {
      secreto[<span class="shj-syn-kwd">this</span>] <span class="shj-syn-oper">=</span> susurro;
    }<span class="shj-syn-oper">,</span>
    revelarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> () {
      <span class="shj-syn-kwd">return</span> secreto[<span class="shj-syn-kwd">this</span>];
    }<span class="shj-syn-oper">,</span>
  };

  global<span class="shj-syn-oper">.</span><span class="shj-syn-class">Persona</span> <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Persona</span>;
})(<span class="shj-syn-kwd">this</span>);

<span class="shj-syn-kwd">var</span> pepe <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();
<span class="shj-syn-kwd">var</span> maria <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();
pepe<span class="shj-syn-oper">.</span><span class="shj-syn-func">guardarSecreto</span>(<span class="shj-syn-str">'estás en matrix'</span>);
console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(maria<span class="shj-syn-oper">.</span><span class="shj-syn-func">revelarSecreto</span>());
</code></pre>
<p><a href="http://jsfiddle.net/amatiasq/NaphB/" target="_blank">Pruébame</a></p>
<p>Esto tampoco funciona, porqué? Para entender ésto hay que investigar un poco, <strong>los índices de los arrays y los mappings en Javascript son <code>strings</code></strong>, y si intentas poner un índice de otro tipo lo convierte a <code>string</code> con el método <code>.toString()</code></p>

<pre><code class="code-block shj-lang-js"><span class="shj-syn-kwd">var</span> array <span class="shj-syn-oper">=</span> [];
array[<span class="shj-syn-num">0</span>] <span class="shj-syn-oper">=</span> <span class="shj-syn-str">'Hola!'</span>;

<span class="shj-syn-kwd">for</span> (<span class="shj-syn-kwd">var</span> i <span class="shj-syn-kwd">in</span> array) {
  <span class="shj-syn-kwd">if</span> (array<span class="shj-syn-oper">.</span><span class="shj-syn-func">hasOwnProperty</span>(i)) {
    console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(
      <span class="shj-syn-str">'Array tiene la propiedad --['</span> <span class="shj-syn-oper">+</span> i <span class="shj-syn-oper">+</span> <span class="shj-syn-str">']-- del tipo --['</span> <span class="shj-syn-oper">+</span> <span class="shj-syn-kwd">typeof</span> i <span class="shj-syn-oper">+</span> <span class="shj-syn-str">']-- con el valor --['</span> <span class="shj-syn-oper">+</span> array[i] <span class="shj-syn-oper">+</span> <span class="shj-syn-str">']--'</span><span class="shj-syn-oper">,</span>
    );
  }
}

<span class="shj-syn-kwd">var</span> mapping <span class="shj-syn-oper">=</span> {};
<span class="shj-syn-kwd">var</span> indice <span class="shj-syn-oper">=</span> {};
mapping[indice] <span class="shj-syn-oper">=</span> <span class="shj-syn-str">'Mundo!'</span>;

<span class="shj-syn-kwd">for</span> (<span class="shj-syn-kwd">var</span> i <span class="shj-syn-kwd">in</span> mapping) {
  <span class="shj-syn-kwd">if</span> (mapping<span class="shj-syn-oper">.</span><span class="shj-syn-func">hasOwnProperty</span>(i)) {
    console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(
      <span class="shj-syn-str">'Mapping tiene la propiedad --['</span> <span class="shj-syn-oper">+</span>
        i <span class="shj-syn-oper">+</span>
        <span class="shj-syn-str">']-- del tipo --['</span> <span class="shj-syn-oper">+</span>
        <span class="shj-syn-kwd">typeof</span> i <span class="shj-syn-oper">+</span>
        <span class="shj-syn-str">']-- con el valor --['</span> <span class="shj-syn-oper">+</span>
        mapping[i] <span class="shj-syn-oper">+</span>
        <span class="shj-syn-str">']--'</span><span class="shj-syn-oper">,</span>
    );
  }
}
</code></pre>
<p><a href="http://jsfiddle.net/amatiasq/cQZmS/" target="_blank">Pruébame</a></p>
<p>Entonces <strong>tanto <code>pepe</code> como <code>maria</code> se convierten a <code>[object Object]</code> cuando los utilizo como índices</strong> del mapping. Y hasta aquí había llegado hasta que descubrí los [<code>WeakMap</code> de Firefox][3]. Consiste básicamente en una clase con métodos <code>.set(id, valor);</code> y <code>.get(id);</code> por lo que cumple la misma funcionalidad que un mapping, con la diferencia de que si el único punto del programa en el que se usa una referencia es un <code>WeakMap</code>, <strong>el recolector de basura la puede borrar</strong>. Es una funcionalidad que es necesaria en Javascript por motivos que no voy a enumerar ahora, pero para mi trae un éxtra: &quot;WeakMaps are key/value maps in which <strong>keys are objects</strong>&quot; (Los WeakMaps son mappings clave/valor donde <strong>las claves son objetos</strong>). Sorpresa! Los <code>WeakMap</code> a diferencia de los mappings comunes no usan strings como claves, sino objetos. Esto haría viable la implementación anterior:</p>

<pre><code class="code-block shj-lang-js">(<span class="shj-syn-kwd">function</span> (global) {
  <span class="shj-syn-kwd">var</span> secreto <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">WeakMap</span>();

  <span class="shj-syn-kwd">function</span> <span class="shj-syn-class">Persona</span>() {}
  <span class="shj-syn-class">Persona</span><span class="shj-syn-oper">.</span>prototype <span class="shj-syn-oper">=</span> {
    guardarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (susurro) {
      secreto<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">set</span>(<span class="shj-syn-kwd">this</span><span class="shj-syn-oper">,</span> susurro);
    }<span class="shj-syn-oper">,</span>
    revelarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> () {
      <span class="shj-syn-cmnt">// Si no tenemos ningún secreto
</span>      <span class="shj-syn-kwd">if</span> (<span class="shj-syn-oper">!</span>secreto<span class="shj-syn-oper">.</span><span class="shj-syn-func">has</span>(<span class="shj-syn-kwd">this</span>)) <span class="shj-syn-kwd">return</span> <span class="shj-syn-str">'Nada'</span>;
      <span class="shj-syn-kwd">else</span> <span class="shj-syn-kwd">return</span> secreto<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">get</span>(<span class="shj-syn-kwd">this</span>);
    }<span class="shj-syn-oper">,</span>
  };

  global<span class="shj-syn-oper">.</span><span class="shj-syn-class">Persona</span> <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Persona</span>;
})(<span class="shj-syn-kwd">this</span>);

<span class="shj-syn-kwd">var</span> pepe <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();
<span class="shj-syn-kwd">var</span> maria <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();

pepe<span class="shj-syn-oper">.</span><span class="shj-syn-func">guardarSecreto</span>(<span class="shj-syn-str">'estás en matrix'</span>);
console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(<span class="shj-syn-str">'Secreto de María: '</span> <span class="shj-syn-oper">+</span> maria<span class="shj-syn-oper">.</span><span class="shj-syn-func">revelarSecreto</span>());
console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(<span class="shj-syn-str">'Secreto de Pepe: '</span> <span class="shj-syn-oper">+</span> pepe<span class="shj-syn-oper">.</span><span class="shj-syn-func">revelarSecreto</span>());
</code></pre>
<p><a href="http://jsfiddle.net/amatiasq/dAzjx/" target="_blank">Pruébame</a></p>
<p><strong>Nota</strong>: Aunque los WeakMap solo están en Firefox, ésto funcionará en todos los navegadores porque he creado una clase que se comporta de forma similar, pero que no permite al recolector de basura eliminar los objetos, la implementación puede verse al final del artículo.</p>
<p>Funciona! Hemos conseguido guardar una variable privada por instancia con un closure por clase. Ahora llémoslo un poco más allá, que pasa si <strong>en lugar de guardar una variable guardamos un objeto donde podremos tener todas las variables que queramos</strong> para ésa instancia?</p>

<pre><code class="code-block shj-lang-js">(<span class="shj-syn-kwd">function</span> (global) {
  <span class="shj-syn-kwd">var</span> privadas <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">WeakMap</span>();

  <span class="shj-syn-kwd">function</span> <span class="shj-syn-class">Persona</span>() {
    <span class="shj-syn-cmnt">// Inicializamos el objeto
</span>    privadas<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">set</span>(<span class="shj-syn-kwd">this</span><span class="shj-syn-oper">,</span> {});
    privadas<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">get</span>(<span class="shj-syn-kwd">this</span>)<span class="shj-syn-oper">.</span>otraPrivada <span class="shj-syn-oper">=</span> <span class="shj-syn-str">'Variable inaccesible desde fuera'</span>;
  }

  <span class="shj-syn-class">Persona</span><span class="shj-syn-oper">.</span>prototype <span class="shj-syn-oper">=</span> {
    guardarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (susurro) {
      privadas<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">get</span>(<span class="shj-syn-kwd">this</span>)<span class="shj-syn-oper">.</span>secreto <span class="shj-syn-oper">=</span> susurro;
    }<span class="shj-syn-oper">,</span>
    revelarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> () {
      <span class="shj-syn-kwd">return</span> privadas<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">get</span>(<span class="shj-syn-kwd">this</span>)<span class="shj-syn-oper">.</span>secreto;
    }<span class="shj-syn-oper">,</span>
  };

  global<span class="shj-syn-oper">.</span><span class="shj-syn-class">Persona</span> <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Persona</span>;
})(<span class="shj-syn-kwd">this</span>);

<span class="shj-syn-kwd">var</span> pepe <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();
<span class="shj-syn-kwd">var</span> maria <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();

pepe<span class="shj-syn-oper">.</span><span class="shj-syn-func">guardarSecreto</span>(<span class="shj-syn-str">'estás en matrix'</span>);
console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(<span class="shj-syn-str">'Secreto de María: '</span> <span class="shj-syn-oper">+</span> maria<span class="shj-syn-oper">.</span><span class="shj-syn-func">revelarSecreto</span>());
</code></pre>
<p><a href="http://jsfiddle.net/amatiasq/RzDAE/" target="_blank">Pruébame</a></p>
<!-- TODO: This causes error `Expected "=>" but found end of file` -->
<!-- Perfecto, pero es un poco raro y repetitivo tener que hacer `privadas.set(this, {});` en el constructor y `privadas.get(this)` pra acceder a las privadas, podríamos encapsular ésto en una función: -->

<pre><code class="code-block shj-lang-js"><span class="shj-syn-kwd">function</span> <span class="shj-syn-func">privadas</span>() {
  <span class="shj-syn-kwd">var</span> map <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">WeakMap</span>();
  <span class="shj-syn-kwd">return</span> <span class="shj-syn-kwd">function</span> (clave) {
    <span class="shj-syn-kwd">if</span> (<span class="shj-syn-oper">!</span>map<span class="shj-syn-oper">.</span><span class="shj-syn-func">has</span>(clave)) map<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">set</span>(clave<span class="shj-syn-oper">,</span> {});
    <span class="shj-syn-kwd">return</span> map<span class="shj-syn-oper">.</span><span class="shj-syn-kwd">get</span>(clave);
  };
}
</code></pre>
<p>Y ahora ésta funcion nos devuelve otra función que podremos llamar cuando queramos con la instancia para obtener las privadas. Nuestra clase queda:</p>

<pre><code class="code-block shj-lang-js">(<span class="shj-syn-kwd">function</span> (global) {
  <span class="shj-syn-kwd">var</span> p <span class="shj-syn-oper">=</span> <span class="shj-syn-func">privadas</span>();

  <span class="shj-syn-kwd">function</span> <span class="shj-syn-class">Persona</span>() {
    <span class="shj-syn-func">p</span>(<span class="shj-syn-kwd">this</span>)<span class="shj-syn-oper">.</span>secreto <span class="shj-syn-oper">=</span> <span class="shj-syn-str">'Nada'</span>;
    <span class="shj-syn-func">p</span>(<span class="shj-syn-kwd">this</span>)<span class="shj-syn-oper">.</span>otraPrivada <span class="shj-syn-oper">=</span> <span class="shj-syn-str">'Variable inaccesible desde fuera'</span>;
  }

  <span class="shj-syn-class">Persona</span><span class="shj-syn-oper">.</span>prototype <span class="shj-syn-oper">=</span> {
    guardarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (susurro) {
      <span class="shj-syn-func">p</span>(<span class="shj-syn-kwd">this</span>)<span class="shj-syn-oper">.</span>secreto <span class="shj-syn-oper">=</span> susurro;
    }<span class="shj-syn-oper">,</span>
    revelarSecreto<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> () {
      <span class="shj-syn-kwd">return</span> <span class="shj-syn-func">p</span>(<span class="shj-syn-kwd">this</span>)<span class="shj-syn-oper">.</span>secreto;
    }<span class="shj-syn-oper">,</span>
  };

  global<span class="shj-syn-oper">.</span><span class="shj-syn-class">Persona</span> <span class="shj-syn-oper">=</span> <span class="shj-syn-class">Persona</span>;
})(<span class="shj-syn-kwd">this</span>);

<span class="shj-syn-kwd">var</span> pepe <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();
<span class="shj-syn-kwd">var</span> maria <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">new</span> <span class="shj-syn-class">Persona</span>();

pepe<span class="shj-syn-oper">.</span><span class="shj-syn-func">guardarSecreto</span>(<span class="shj-syn-str">'estás en matrix'</span>);
console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(<span class="shj-syn-str">'Secreto de María: '</span> <span class="shj-syn-oper">+</span> maria<span class="shj-syn-oper">.</span><span class="shj-syn-func">revelarSecreto</span>());
console<span class="shj-syn-oper">.</span><span class="shj-syn-func">log</span>(<span class="shj-syn-str">'Secreto de Pepe: '</span> <span class="shj-syn-oper">+</span> pepe<span class="shj-syn-oper">.</span><span class="shj-syn-func">revelarSecreto</span>());
</code></pre>
<p><a href="http://jsfiddle.net/amatiasq/XmKCH/" target="_blank">Pruébame</a></p>
<p>Y voilá! Tenemos privadas por clases sin crear más de un closure. :D</p>
<h3 id="resumen">Resumen</h3>
<p>Está claro que <strong>es aberrante pensar en crear una arquitectura basada en éste sistema</strong>, incluso dejando de lado lo extraño de la sintaxis (<code>p(this)</code> para acceder a las privadas), <strong>sería peligroso</strong> porque aunque Firefox nos ofrezca <code>WeakMap</code> en el resto de navegadores tendríamos que crear una funcionalidad similiar y no podríamos evitar tener una referencia a las instancias si queremos que el sistema sea irrompible, lo que haría que el recolector de basura no pudiera borrar las instancias que ya no utilizemos con <strong>riesgo de llenar la memoria RAM disponible</strong>.</p>
<p>Como ya he dicho muchas veces, la gracia de <strong>esto no es forzar Javascript a su límite, sino forzar la mente</strong>, si hoy forzamos la imaginación hasta sus límites mañana podremos sobrepasarlos. La idea es ejercitar y mejorar la capacidad de buscar soluciones creativas y funcionales por extrañas o imposibles que parezcan.</p>
<p>Finalmente, como expliqué en la nota, aquí está la implementación que usé para que los ejemplos funcionen en navegadores que no sean Firefox, guarda en los objetos la propiedad <em>$$ID</em> para no tener que buscar en todo el array de claves el índice del objeto:</p>

<pre><code class="code-block shj-lang-js"><span class="shj-syn-kwd">if</span> (<span class="shj-syn-kwd">typeof</span> <span class="shj-syn-class">WeakMap</span> <span class="shj-syn-oper">===</span> <span class="shj-syn-str">'undefined'</span>) {
  window<span class="shj-syn-oper">.</span><span class="shj-syn-class">WeakMap</span> <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">function</span> <span class="shj-syn-class">WeakMap</span>() {
    <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>keys <span class="shj-syn-oper">=</span> [];
    <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>values <span class="shj-syn-oper">=</span> [];
  };
  <span class="shj-syn-class">WeakMap</span><span class="shj-syn-oper">.</span>prototype <span class="shj-syn-oper">=</span> {
    <span class="shj-syn-kwd">constructor</span><span class="shj-syn-oper">:</span> <span class="shj-syn-class">WeakMap</span><span class="shj-syn-oper">,</span>

    <span class="shj-syn-kwd">set</span><span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (key<span class="shj-syn-oper">,</span> value) {
      <span class="shj-syn-kwd">var</span> id <span class="shj-syn-oper">=</span> (key<span class="shj-syn-oper">.</span>$$<span class="shj-syn-num">ID</span> <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>keys<span class="shj-syn-oper">.</span>length);
      <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>keys[id] <span class="shj-syn-oper">=</span> key;
      <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>values[id] <span class="shj-syn-oper">=</span> value;
    }<span class="shj-syn-oper">,</span>

    <span class="shj-syn-kwd">get</span><span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (key) {
      <span class="shj-syn-kwd">var</span> id <span class="shj-syn-oper">=</span> key<span class="shj-syn-oper">.</span>$$<span class="shj-syn-num">ID</span>;

      <span class="shj-syn-cmnt">// Si el índice del objeto no se corresponde
</span>      <span class="shj-syn-cmnt">// con su posición en la lista de claves
</span>      <span class="shj-syn-cmnt">// Es que ha sido modificado, debemos corregirlo.
</span>      <span class="shj-syn-kwd">if</span> (<span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>keys[id] <span class="shj-syn-oper">!==</span> key) id <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">_fixIndex</span>(key);

      <span class="shj-syn-kwd">return</span> <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>values[id];
    }<span class="shj-syn-oper">,</span>

    has<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (key) {
      <span class="shj-syn-kwd">return</span> <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span><span class="shj-syn-func">_fixIndex</span>(key) <span class="shj-syn-oper">!==</span> <span class="shj-syn-num">null</span>;
    }<span class="shj-syn-oper">,</span>

    _fixIndex<span class="shj-syn-oper">:</span> <span class="shj-syn-kwd">function</span> (key) {
      <span class="shj-syn-kwd">for</span> (<span class="shj-syn-kwd">var</span> i <span class="shj-syn-oper">=</span> <span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>keys<span class="shj-syn-oper">.</span>length; i<span class="shj-syn-oper">--</span>; ) <span class="shj-syn-kwd">if</span> (<span class="shj-syn-kwd">this</span><span class="shj-syn-oper">.</span>keys[i] <span class="shj-syn-oper">===</span> key) <span class="shj-syn-kwd">return</span> (key<span class="shj-syn-oper">.</span>$$<span class="shj-syn-num">ID</span> <span class="shj-syn-oper">=</span> i);
      <span class="shj-syn-kwd">return</span> <span class="shj-syn-num">null</span>;
    }<span class="shj-syn-oper">,</span>
  };
}
</code></pre>

</article></div><label for="color-picker" class="css-1dwwgr5"><input type="color" id="color-picker" value="#00ffe1"/><p>Change the main color!</p></label></body></html>